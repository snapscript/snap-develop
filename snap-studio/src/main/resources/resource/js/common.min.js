define(["require","exports","jquery","w2ui"],function(x,n,q,v){(function(c){function n(a,b){return b&&0<b.length?w(a,b[0].field,b[0].direction):a}function w(a,b,d){for(var f=[],g={},e=!0,h=0;h<a.length;h++){var l=a[h];if(l){var c=l[b];"string"==typeof c&&(c=c.toLowerCase());"number"!=typeof c&&(e=!1);var k=g[c];null==k&&(k=[],g[c]=k);k.push(l)}}a=[];for(var m in g)g.hasOwnProperty(m)&&(e?a.push(parseFloat(m)):a.push(m));e?a.sort(function(a,d){return a-d}):a.sort();"asc"!=d&&a.reverse();for(h=0;h<
a.length;h++)for(c=a[h],k=g[c],d=0;d<k.length;d++)l=k[d],f.push(l);return f}function r(a,b){return function(d){var f=a;a=null;f&&(b?setTimeout(function(){f(d)},b):f(d))}}function t(a,b,d){return a&&b&&d?a.split(b).join(d):a}function u(){return(new Date).getTime()}c.openDialog=function(a,b,d,f){var c=u();a=window.open(a,b+c,"height\x3d"+f+",width\x3d"+d);void 0!=a&&a.focus&&(a.resizeTo(d,f),a.focus());return!1};c.extractParameter=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?\x26]"+
a+"\x3d([^\x26#]*)")).exec(window.location.href);return null==a?"":a[1]};c.decodeValue=function(a){if(0<a.length){var b=("@"+a).substring(2);if("\x3c"==a.charAt(0)){a=b.toString();for(var b="",d=0;d<a.length;d+=2)var c=a.substr(d,2),c=parseInt(c,16),b=b+String.fromCharCode(c)}return b}return null};c.updateTableRecords=function(a,b){var d=v.w2ui[b];if(d){var c=q("#grid_"+b+"_records").prop("scrollTop"),g=d.records,e=d.sortData,h=!1;if(a.length==g.length){for(var l=0;l<a.length;l++){var p=g[l],k=a[l];
if(!p||p.length!=k.length){h=!0;break}for(var m in p)if(p.hasOwnProperty(m)){if(!k.hasOwnProperty(m)){h=!0;break}if(p[m]!=k[m]){h=!0;break}}}h&&(d.records=n(a,e),d.refresh())}else d.records=n(a,e),d.refresh(),h=!0;a.length>g.length&&(d.reload(),q("#grid_"+b+"_records").prop("scrollTop",c));return h}return!1};c.createOneTimeFunction=r;c.createSimpleStateMachineFunction=function(a,b,d,c){var g=r(b,c),e=[];return function(b){if(0<d.length){var c;c=d.indexOf(b);-1<c?(d.splice(c,1),c=!0):c=!1;c?(c=e.indexOf(b),
-1==c&&e.push(b),console.log("["+a+"] Received event '"+b+"' "+d.length+" remain")):(c=e.indexOf(b),-1==c&&console.warn("["+a+"] Ignoring unknown event '"+b+"' "+d.length+" remain"));0>=d.length&&g()}}};c.getElementsByClassName=function(a,b){function d(a){for(var e=0;e<a.childNodes.length;e++)0<a.childNodes[e].childNodes.length&&d(a.childNodes[e]),a.childNodes[e].getAttribute&&a.childNodes[e].getAttribute("class")&&0<=a.childNodes[e].getAttribute("class").split(" ").indexOf(b)&&c.push(a.childNodes[e])}
var c=[];d(a);return c};c.isChildElementVisible=function(a,b){var c=b.getBoundingClientRect(),f=a.getBoundingClientRect(),g=c.top+c.height,e=f.top+a.clientHeight;return c.top>f.top&&g<e};c.calculateScrollOffset=function(a,c){var b=c.getBoundingClientRect(),f=a.getBoundingClientRect(),g=b.top,e=f.top;if(g<e)return g-e;b=b.top+b.height;f=f.top+a.clientHeight;return b>f?b-f:0};c.formatTimeMillis=function(a){a=(new Date(a)).toISOString();var b=a.indexOf(".");a=a.substring(0,b);return t(a,"T"," ")};c.stringReplaceText=
t;c.stringContains=function(a,b){return a&&b?-1!==a.indexOf(b):!1};c.stringEndsWith=function(a,b){return a&&b&&a.length>=b.length?a.slice(-b.length)==b:!1};c.stringStartsWith=function(a,b){return a&&b&&a.length>=b.length?a.substring(0,b.length)===b:!1};c.isMacintosh=function(){return-1<navigator.platform.indexOf("Mac")};c.isWindows=function(){return-1<navigator.platform.indexOf("Win")};c.escapeHtml=function(a){return a.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,
"\x26quot;").replace(/'/g,"\x26#039;")};c.clearHtml=function(a){return a.replace(/<br>/g,"").replace(/&quot;/g,'"').replace(/&lt;/g,"\x3c").replace(/&gt;/g,"\x3e").replace(/&nbsp;/g," ").replace(/&amp;/g,"\x26")};c.currentTime=u})(n.Common||(n.Common={}))});
