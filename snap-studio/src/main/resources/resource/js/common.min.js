define(["require","exports","jquery","w2ui"],function(w,n,q,v){(function(c){function n(a,b){var d;if(b&&0<b.length){var e=b[0].field,g=b[0].direction;d=[];for(var f={},m=0;m<a.length;m++){var k=a[m];if(k){var c=k[e].toLowerCase(),h=f[c];null==h&&(h=[],f[c]=h);h.push(k)}}var e=[],l;for(l in f)f.hasOwnProperty(l)&&e.push(l);e.sort();"asc"!=g&&e.reverse();for(m=0;m<e.length;m++)for(c=e[m],h=f[c],g=0;g<h.length;g++)k=h[g],d.push(k)}else d=a;return d}function r(a,b){return function(d){var e=a;a=null;e&&
(b?setTimeout(function(){e(d)},b):e(d))}}function t(a,b,d){return a&&b&&d?a.split(b).join(d):a}function u(){return(new Date).getTime()}c.openDialog=function(a,b,d,e){var g=u();a=window.open(a,b+g,"height\x3d"+e+",width\x3d"+d);void 0!=a&&a.focus&&(a.resizeTo(d,e),a.focus());return!1};c.extractParameter=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?\x26]"+a+"\x3d([^\x26#]*)")).exec(window.location.href);return null==a?"":a[1]};c.decodeValue=function(a){if(0<a.length){var b=
("@"+a).substring(2);if("\x3c"==a.charAt(0)){a=b.toString();for(var b="",d=0;d<a.length;d+=2)var e=a.substr(d,2),e=parseInt(e,16),b=b+String.fromCharCode(e)}return b}return null};c.updateTableRecords=function(a,b){var d=v.w2ui[b];if(d){var e=q("#grid_"+b+"_records").prop("scrollTop"),g=d.records,f=d.sortData,c=!1;if(a.length==g.length){for(var k=0;k<a.length;k++){var p=g[k],h=a[k];if(!p||p.length!=h.length){c=!0;break}for(var l in p)if(p.hasOwnProperty(l)){if(!h.hasOwnProperty(l)){c=!0;break}if(p[l]!=
h[l]){c=!0;break}}}c&&(d.records=n(a,f),d.refresh())}else d.records=n(a,f),d.refresh(),c=!0;a.length>g.length&&(d.reload(),q("#grid_"+b+"_records").prop("scrollTop",e));return c}return!1};c.createOneTimeFunction=r;c.createSimpleStateMachineFunction=function(a,b,d,e){var c=r(b,e),f=[];return function(b){if(0<d.length){var e;e=d.indexOf(b);-1<e?(d.splice(e,1),e=!0):e=!1;e?(e=f.indexOf(b),-1==e&&f.push(b),console.log("["+a+"] Received event '"+b+"' "+d.length+" remain")):(e=f.indexOf(b),-1==e&&console.warn("["+
a+"] Ignoring unknown event '"+b+"' "+d.length+" remain"));0>=d.length&&c()}}};c.getElementsByClassName=function(a,b){function d(a){for(var c=0;c<a.childNodes.length;c++)0<a.childNodes[c].childNodes.length&&d(a.childNodes[c]),a.childNodes[c].getAttribute&&a.childNodes[c].getAttribute("class")&&0<=a.childNodes[c].getAttribute("class").split(" ").indexOf(b)&&e.push(a.childNodes[c])}var e=[];d(a);return e};c.isChildElementVisible=function(a,b){var d=b.getBoundingClientRect(),e=a.getBoundingClientRect(),
c=d.top+d.height,f=e.top+a.clientHeight;return d.top>e.top&&c<f};c.calculateScrollOffset=function(a,b){var d=b.getBoundingClientRect(),e=a.getBoundingClientRect(),c=d.top,f=e.top;if(c<f)return c-f;d=d.top+d.height;e=e.top+a.clientHeight;return d>e?d-e:0};c.formatTimeMillis=function(a){a=(new Date(a)).toISOString();var b=a.indexOf(".");a=a.substring(0,b);return t(a,"T"," ")};c.stringReplaceText=t;c.stringContains=function(a,b){return a&&b?-1!==a.indexOf(b):!1};c.stringEndsWith=function(a,b){return a&&
b&&a.length>=b.length?a.slice(-b.length)==b:!1};c.stringStartsWith=function(a,b){return a&&b&&a.length>=b.length?a.substring(0,b.length)===b:!1};c.isMacintosh=function(){return-1<navigator.platform.indexOf("Mac")};c.isWindows=function(){return-1<navigator.platform.indexOf("Win")};c.escapeHtml=function(a){return a.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#039;")};c.clearHtml=function(a){return a.replace(/<br>/g,"").replace(/&quot;/g,
'"').replace(/&lt;/g,"\x3c").replace(/&gt;/g,"\x3e").replace(/&nbsp;/g," ").replace(/&amp;/g,"\x26")};c.currentTime=u})(n.Common||(n.Common={}))});
