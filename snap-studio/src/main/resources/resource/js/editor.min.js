define("require exports jquery md5 ace w2ui common socket problem spinner tree history project status keys commands".split(" "),function(O,m,u,E,z,F,h,K,L,A,x,M,G,N,B,C){var H=function(){function e(e,h){this.editorBreakpoints={};this.editorMarkers={};this.editorText=this.editorResource=null;this.editorCurrentTokens={};this.editorFocusToken=null;this.editorHistory={};this.editorPanel=null;this.editorPanel=e;this.editorTheme=h}e.prototype.init=function(){B.KeyBinder.bindKeys();G.Project.changeProjectFont();
v.scrollEditorToTop();A.LoadSpinner.finish()};return e}();m.FileEditorView=H;var v;(function(e){function p(){var a=b.editorPanel.getSession(),d;for(d in b.editorMarkers)if(b.editorMarkers.hasOwnProperty(d)){var c=b.editorMarkers[d];null!=c&&a.removeMarker(c)}b.editorMarkers={}}function m(a){b.editorPanel.resize(!0);1<a?b.editorPanel.scrollToLine(a-1,!0,!0,function(){}):b.editorPanel.scrollToLine(0,!0,!0,function(){})}function D(){var a=[],d=1,c;for(c in b.editorBreakpoints)if(b.editorBreakpoints.hasOwnProperty(c)){var k=
b.editorBreakpoints[c],e;for(e in k)if(k.hasOwnProperty(e)&&1==k[e]){var f=x.FileTree.createResourcePath(c),l="\x3cdiv class\x3d'breakpointEnabled'\x3e"+f.projectPath+"\x3c/div\x3e";a.push({recid:d++,name:l,location:"Line "+e,resource:f.projectPath,line:parseInt(e),script:f.resourcePath})}}F.w2ui.breakpoints.records=a;F.w2ui.breakpoints.refresh();C.Command.updateScriptBreakpoints()}function w(){var a;a=b.editorPanel.getSession().getUndoManager();var d=u.extend(!0,{},a.$undoStack),c=u.extend(!0,{},
a.$redoStack);a={undoStack:d,redoStack:c,dirtyCounter:a.dirtyCounter};d=b.editorPanel.getSession().getScrollTop();d=(c=b.editorPanel.selection.getCursor())&&c.row&&c.column?{row:c.row,column:c.column,scroll:d}:{scroll:d,row:null,column:null};c=b.editorPanel.getValue();return{breakpoints:b.editorBreakpoints,resource:b.editorResource,history:a,position:d,source:c}}function v(a){a=a.toLowerCase();return h.Common.stringEndsWith(a,".snap")?"ace/mode/snapscript":h.Common.stringEndsWith(a,".xml")?"ace/mode/xml":
h.Common.stringEndsWith(a,".json")?"ace/mode/json":h.Common.stringEndsWith(a,".sql")?"ace/mode/sql":h.Common.stringEndsWith(a,".js")?"ace/mode/javascript":h.Common.stringEndsWith(a,".html")||h.Common.stringEndsWith(a,".htm")?"ace/mode/html":h.Common.stringEndsWith(a,".txt")?"ace/mode/text":h.Common.stringEndsWith(a,".properties")?"ace/mode/properties":h.Common.stringEndsWith(a,".gitignore")?"ace/mode/text":h.Common.stringEndsWith(a,".project")||h.Common.stringEndsWith(a,".classpath")?"ace/mode/xml":
"ace/mode/text"}function A(a,d){var c=d.toLowerCase(),k=/(function|static|public|private|abstract|override|)\s+([a-z][a-zA-Z0-9]*)\s*\(/g,e=/(var|const)\s+([a-z][a-zA-Z0-9]*)/g,f=/(class|trait|enum)\s+([A-Z][a-zA-Z0-9]*)/g,l=/import\s+([a-z][a-zA-Z0-9\.]*)\.([A-Z][a-zA-Z]*)/g,n={};if(h.Common.stringEndsWith(c,".snap"))for(var c=a.split(/\r?\n/),g=0;g<c.length;g++){var q=c[g];y(q,g+1,k,n,["%s("],!1);y(q,g+1,e,n,"%s.;%s\x3d;%s \x3d;%s\x3c;%s \x3c;%s\x3e;%s \x3e;%s!;%s !;%s-;%s -;%s+;%s +;%s*;%s *;%s%;%s %;%s/;%s /".split(";"),
!1);y(q,g+1,l,n,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!0);y(q,g+1,f,n,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!1)}b.editorCurrentTokens=n;if(null!=b.editorFocusToken){var r=b.editorCurrentTokens[b.editorFocusToken];null!=r&&(setTimeout(function(){m(r.line)},100),b.editorFocusToken=null)}}function y(a,b,c,k,e,f){c.lastIndex=0;c=c.exec(a);if(null!=c&&0<c.length){a=c[1];c=c[2];for(var d=0;d<e.length;d++){var n=
e[d].replace("%s",c);k[n]=f?{resource:"/"+a.replace(".","/")+".snap",line:b}:{resource:null,line:b}}}}function I(){var a=b.editorPanel.getSession();if(b.editorResource&&b.editorResource.resourcePath){var d=b.editorHistory[b.editorResource.resourcePath];if(d&&d.position){var c=d.position.scroll,e=d.position.row,d=d.position.column;e&&d&&0<=e&&0<=d?b.editorPanel.selection.moveTo(e,d):b.editorPanel.gotoLine(1);a.setScrollTop(c)}else b.editorPanel.gotoLine(1),a.setScrollTop(0)}else b.editorPanel.gotoLine(1),
a.setScrollTop(0);b.editorPanel.focus()}function J(){return{getCompletions:function(a,b,c,e,h){0===e.length?h(null,[]):(b=a.getValue(),a=a.session.getLine(c.row).substring(0,c.column-e.length),c=JSON.stringify({resource:editorResource.projectPath,line:c.row,complete:a,source:b,prefix:e}),u.ajax({contentType:"application/json",data:c,dataType:"json",success:function(a){a=a.tokens;var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push({name:c,value:c,score:300,meta:a[c]});h(null,b)},error:function(){console.log("Completion control failed")},
processData:!1,type:"POST",url:"/complete/"+document.title}))}}}function B(){var a=z.ace.edit("editor"),d=J();a.completers=[d];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});
a.on("guttermousedown",function(c){var d=c.domEvent.target;if(-1!=d.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(c.clientX>25+d.getBoundingClientRect().left)){var e=c.getDocumentPosition().row;if(null!=b.editorResource){var f=b.editorPanel.getSession(),d=b.editorBreakpoints[b.editorResource.filePath],h=f.getBreakpoints(),n=!1,g;for(g in h)if(g==e){n=!0;break}n?f.clearBreakpoint(e):f.setBreakpoint(e);g=parseInt(e);null==d?(d={},d[g+1]=!0,b.editorBreakpoints[b.editorResource.filePath]=d):
d[g+1]=1==d[g+1]?!1:!0}D();c.stop()}});"undefined"!==typeof java&&a.setScrollSpeed(.05);return new H(a,editorTheme)}var b=null;e.createEditor=function(){b=B();b.init();K.EventBus.createTermination(p)};e.clearEditorHighlights=p;e.showEditorLine=m;e.createEditorHighlight=function(a,d){var c=z.ace.require("ace/range").Range,e=b.editorPanel.getSession();p();c=e.addMarker(new c(a-1,0,a-1,1),d,"fullLine");b.editorMarkers[a]=c};e.findAndReplaceTextInEditor=function(){var a=w();C.Command.searchAndReplaceFiles(a.resource.projectPath)};
e.findTextInEditor=function(){var a=w();C.Command.searchFiles(a.resource.projectPath)};e.addEditorKeyBinding=function(a,d){b.editorPanel.commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){d&&d()}})};e.showEditorBreakpoints=D;e.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,d=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+d);b.editorPanel.setAutoScrollEditorIntoView(!0);b.editorPanel.resize(!0)};e.resetEditor=
function(){var a=b.editorPanel.getSession();p();b.editorResource=null;b.editor.setReadOnly(!1);a.setValue(b.editorText,1);u("#currentFile").html("")};e.loadEditor=w;e.resolveEditorMode=v;e.updateEditor=function(a,d){var c=b.editorPanel.getSession(),k=c.getMode(),t=v(d);a:{var f=a;if(f){var l=d.toLowerCase();if(h.Common.stringEndsWith(l,".json"))try{var n=JSON.parse(f);a=JSON.stringify(n,null,3);break a}catch(P){}a=f}else a=""}f=w();f.resource&&f.source&&(l=E.md5(f.source),b.editorHistory[f.resource.resourcePath]=
{hash:l,history:f.history,position:f.position});t!=k&&c.setMode({path:t,v:Date.now()});b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(a,1);l=a;k=new z.ace.UndoManager;if(l&&d&&(f=x.FileTree.createResourcePath(d),t=b.editorHistory[f.resourcePath]))if(l=E.md5(l),t.hash==l){var f=t.history.undoStack,l=t.history.redoStack,g;for(g in f)f.hasOwnProperty(g)&&(k.$undoStack[g]=f[g]);for(var q in l)l.hasOwnProperty(q)&&(k.$redoStack[q]=f[q]);k.$doc=c;k.dirtyCounter=t.history.dirtyCounter}else b.editorHistory[f.resourcePath]=
null;c.setUndoManager(k);var c=b.editorPanel.getSession(),r;for(r in c.$backMarkers)c.removeMarker(b.editorMarker);r=c.getBreakpoints();for(var m in r)c.clearBreakpoint(m);u("#currentFile").html("");b.editorResource=x.FileTree.createResourcePath(d);b.editorText=a;window.location.hash=b.editorResource.projectPath;L.ProblemManager.highlightProblems();if(null!=d&&b.editorResource&&(m=b.editorBreakpoints[b.editorResource.filePath],null!=m))for(var p in m)m.hasOwnProperty(p)&&1==m[p]&&(g=p-1,null!=b.editorResource&&
(r=b.editorPanel.getSession(),c=b.editorBreakpoints[b.editorResource.filePath],g=parseInt(g),r.setBreakpoint(g),null==c&&(c={},b.editorBreakpoints[b.editorResource.filePath]=c),c[g+1]=!0),D());A(a,d);G.Project.createEditorTab();M.History.showFileHistory();N.StatusPanel.showActiveFile(b.editorResource.projectPath);e.showEditorFileInTree();I()};e.showEditorFileInTree=function(){var a=w().resource;x.FileTree.showTreeNode("explorerTree",a)};e.getSelectedText=function(){return b.editorPanel.getSelectedText()};
e.isEditorChanged=function(){return null!=b.editorResource?b.editorPanel.getValue()!=b.editorText:!1};e.scrollEditorToTop=I;e.formatEditorSource=function(){var a=b.editorPanel.getValue();u.ajax({contentType:"text/plain",data:a,success:function(a){b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title})};e.setEditorTheme=function(a){null!=a&&(null!=b.editorPanel&&b.editorPanel.setTheme(a),b.editorTheme=
a)};e.updateEditorFont=function(a,d){var c=J();b.editorPanel.completers=[c];b.editorPanel.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:d})}})(v=m.FileEditor||(m.FileEditor={}))});
