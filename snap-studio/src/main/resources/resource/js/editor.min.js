define("require exports jquery md5 ace w2ui common socket problem spinner tree history project status keys commands".split(" "),function(R,p,t,G,A,H,f,M,N,q,u,O,B,P,Q,r){var I=function(){function d(d,f){this.editorBreakpoints={};this.editorMarkers={};this.editorTheme=this.editorLastModified=this.editorText=this.editorResource=null;this.editorCurrentTokens={};this.editorFocusToken=null;this.editorHistory={};this.editorPanel=null;this.editorLastModified=(new Date).getTime();this.editorPanel=d;this.editorTheme=
f}d.prototype.init=function(){Q.KeyBinder.bindKeys();B.Project.changeProjectFont();w.scrollEditorToPosition();w.updateProjectTabOnChange();q.LoadSpinner.finish()};return d}();p.FileEditorView=I;var w;(function(d){function v(){var a=b.editorPanel.getSession(),c;for(c in b.editorMarkers)if(b.editorMarkers.hasOwnProperty(c)){var e=b.editorMarkers[c];null!=e&&a.removeMarker(e)}b.editorMarkers={}}function p(){var a=[],c=1,e;for(e in b.editorBreakpoints)if(b.editorBreakpoints.hasOwnProperty(e)){var d=b.editorBreakpoints[e],
g;for(g in d)if(d.hasOwnProperty(g)&&1==d[g]){var h=u.FileTree.createResourcePath(e),f="\x3cdiv class\x3d'breakpointEnabled'\x3e"+h.projectPath+"\x3c/div\x3e";a.push({recid:c++,name:f,location:"Line "+g,resource:h.projectPath,line:parseInt(g),script:h.resourcePath})}}H.w2ui.breakpoints.records=a;H.w2ui.breakpoints.refresh();r.Command.updateScriptBreakpoints()}function y(){var a;a=b.editorPanel.getSession().getUndoManager();var c=t.extend(!0,{},a.$undoStack),e=t.extend(!0,{},a.$redoStack);a={undoStack:c,
redoStack:e,dirtyCounter:a.dirtyCounter};c=b.editorPanel.getSession().getScrollTop();c=(e=b.editorPanel.selection.getCursor())?{row:e.row,column:e.column,scroll:c}:{scroll:c,row:null,column:null};e=b.editorPanel.getValue();return{lastModified:b.editorLastModified,breakpoints:b.editorBreakpoints,resource:b.editorResource,history:a,position:c,source:e}}function w(a){a=a.toLowerCase();if(f.Common.stringEndsWith(a,".snap"))return"ace/mode/snapscript";if(f.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";
if(f.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(f.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";if(f.Common.stringEndsWith(a,".pl"))return"ace/mode/perl";if(f.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(f.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(f.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(f.Common.stringEndsWith(a,".java"))return"ace/mode/java";if(f.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(f.Common.stringEndsWith(a,
".py"))return"ace/mode/python";if(f.Common.stringEndsWith(a,".html")||f.Common.stringEndsWith(a,".htm"))return"ace/mode/html";if(f.Common.stringEndsWith(a,".txt"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(f.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".project"))return"ace/mode/xml";f.Common.stringEndsWith(a,".classpath");return"ace/mode/text"}function C(a){a=u.FileTree.createResourcePath(a);return null!=
b.editorResource&&b.editorResource.resourcePath==a.resourcePath?(a=y(),{text:a.source,lastModified:a.lastModified}):(a=b.editorHistory[a.resourcePath])?{text:a.buffer,lastModified:a.lastModified}:null}function D(){return null!=b.editorResource?b.editorPanel.getValue()!=b.editorText:!1}function J(a){return null!=b.editorResource&&b.editorResource.resourcePath==a?D():C(a)?!0:!1}function K(){var a=b.editorPanel.getSession();if(b.editorResource&&b.editorResource.resourcePath){var c=b.editorHistory[b.editorResource.resourcePath];
if(c&&c.position){var e=c.position.scroll,d=c.position.row,c=c.position.column;0<=d&&0<=c?b.editorPanel.selection.moveTo(d,c):b.editorPanel.gotoLine(1);a.setScrollTop(e)}else b.editorPanel.gotoLine(1),a.setScrollTop(0)}else b.editorPanel.gotoLine(1),a.setScrollTop(0);b.editorPanel.focus()}function E(a){B.Project.markEditorTab(a,J(a))}function L(){return{getCompletions:function(a,c,e,d,g){c=a.getValue();var x=a.session.getLine(e.row);a=b.editorResource.projectPath;x=x.substring(0,e.column);e=JSON.stringify({resource:a,
line:e.row+1,complete:x,source:c,prefix:d});t.ajax({contentType:"application/json",data:e,dataType:"json",success:function(a){var b=a.expression,e=Math.max(0,b.lastIndexOf(".")+1);a=a.tokens;var c=[],d;for(d in a)if(a.hasOwnProperty(d)){var x=a[d];f.Common.stringStartsWith(d,b)&&(d=d.substring(e));c.push({className:"autocomplete_"+x,token:d,value:d,score:300,meta:x})}g(null,c)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title})}}}
function q(){var a=A.ace.edit("editor"),c=L();a.completers=[c];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(e){var c=e.domEvent.target;
if(-1!=c.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(e.clientX>25+c.getBoundingClientRect().left)){var d=e.getDocumentPosition().row;if(null!=b.editorResource){var f=b.editorPanel.getSession(),c=b.editorBreakpoints[b.editorResource.filePath],l=f.getBreakpoints(),k=!1,m;for(m in l)if(m==d){k=!0;break}k?f.clearBreakpoint(d):f.setBreakpoint(d);m=parseInt(d);null==c?(c={},c[m+1]=!0,b.editorBreakpoints[b.editorResource.filePath]=c):c[m+1]=1==c[m+1]?!1:!0}p();e.stop()}});"undefined"!==typeof java&&
a.setScrollSpeed(.05);return new I(a,editorTheme)}var b=null;d.createEditor=function(){b=q();b.init();M.EventBus.createTermination(v)};d.clearEditorHighlights=v;d.showEditorLine=function(a){b.editorPanel.resize(!0);1<a?(b.editorPanel.scrollToLine(a-1,!0,!0,function(){}),b.editorPanel.gotoLine(a)):b.editorPanel.scrollToLine(0,!0,!0,function(){});b.editorPanel.focus()};d.createEditorHighlight=function(a,c){var e=A.ace.require("ace/range").Range,d=b.editorPanel.getSession();v();e=d.addMarker(new e(a-
1,0,a-1,1),c,"fullLine");b.editorMarkers[a]=e};d.createMultipleEditorHighlights=function(a,c){var e=A.ace.require("ace/range").Range,d=b.editorPanel.getSession();v();for(var f=0;f<a.length;f++){var h=a[f],l=d.addMarker(new e(h-1,0,h-1,1),c,"fullLine");b.editorMarkers[h]=l}};d.findAndReplaceTextInEditor=function(){var a=y();r.Command.searchAndReplaceFiles(a.resource.projectPath)};d.findTextInEditor=function(){var a=y();r.Command.searchFiles(a.resource.projectPath)};d.addEditorKeyBinding=function(a,
c){b.editorPanel.commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){c&&c()}})};d.showEditorBreakpoints=p;d.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,c=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+c);b.editorPanel.setAutoScrollEditorIntoView(!0);b.editorPanel.resize(!0)};d.resetEditor=function(){var a=b.editorPanel.getSession();v();b.editorResource=null;b.editorPanel.setReadOnly(!1);a.setValue(b.editorText,
1);t("#currentFile").html("")};d.loadEditor=y;d.resolveEditorMode=w;d.clearSavedEditorBuffer=function(a){a=u.FileTree.createResourcePath(a);var c=b.editorHistory[a.resourcePath];c&&(c.lastModified=-1,c.buffer=null,E(a.resourcePath))};d.loadSavedEditorBuffer=C;d.updateEditor=function(a,c,e){console.log(c+" was modified on "+new Date(e)+" "+(a?a.length:"NULL"));var f=b.editorPanel.getSession(),g=f.getMode(),h=w(c),l=C(c),k=a;l&&l.text&&l.lastModified>e&&(console.log("buffer is newer, difference is "+
l.lastModified-e),k=l.text);e=y();if(e.resource&&e.source){var l=G.md5(e.source),m=b.editorPanel.getValue(),m=D()?m:null;b.editorHistory[e.resource.resourcePath]={hash:l,lastModified:e.lastModified,history:e.history,position:e.position,buffer:m}}h!=g&&f.setMode({path:h,v:Date.now()});b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(k,1);e=k;g=new A.ace.UndoManager;if(e&&c&&(k=u.FileTree.createResourcePath(c),h=b.editorHistory[k.resourcePath]))if(e=G.md5(e),h.hash==e){k=h.history.undoStack;e=h.history.redoStack;
for(var q in k)k.hasOwnProperty(q)&&(g.$undoStack[q]=k[q]);for(var r in e)e.hasOwnProperty(r)&&(g.$redoStack[r]=k[r]);g.$doc=f;g.dirtyCounter=h.history.dirtyCounter}else b.editorHistory[k.resourcePath]=null;f.setUndoManager(g);var f=b.editorPanel.getSession(),n;for(n in f.$backMarkers)f.removeMarker(b.editorMarker);v();n=f.getBreakpoints();for(var z in n)f.clearBreakpoint(z);t("#currentFile").html("");b.editorResource=u.FileTree.createResourcePath(c);b.editorText=a;window.location.hash=b.editorResource.projectPath;
N.ProblemManager.highlightProblems();if(null!=c&&b.editorResource&&(a=b.editorBreakpoints[b.editorResource.filePath],null!=a))for(var F in a)a.hasOwnProperty(F)&&1==a[F]&&(n=F-1,null!=b.editorResource&&(c=b.editorPanel.getSession(),z=b.editorBreakpoints[b.editorResource.filePath],n=parseInt(n),c.setBreakpoint(n),null==z&&(z={},b.editorBreakpoints[b.editorResource.filePath]=z),z[n+1]=!0),p());B.Project.createEditorTab();O.History.showFileHistory();P.StatusPanel.showActiveFile(b.editorResource.projectPath);
d.showEditorFileInTree();K();E(b.editorResource.resourcePath)};d.showEditorFileInTree=function(){var a=y().resource;u.FileTree.showTreeNode("explorerTree",a)};d.getCurrentLineForEditor=function(){return b.editorPanel.getSelectionRange().start.row};d.getSelectedText=function(){return b.editorPanel.getSelectedText()};d.isEditorChanged=D;d.isEditorChangedForPath=J;d.scrollEditorToPosition=K;d.updateProjectTabOnChange=function(){b.editorPanel.on("input",function(){b.editorLastModified=(new Date).getTime();
E(b.editorResource.resourcePath)})};d.formatEditorSource=function(){var a=b.editorPanel.getValue();t.ajax({contentType:"text/plain",data:a,success:function(a){b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title+b.editorResource.filePath})};d.setEditorTheme=function(a){null!=a&&(null!=b.editorPanel&&b.editorPanel.setTheme(a),b.editorTheme=a)};d.updateEditorFont=function(a,c){var d=L();b.editorPanel.completers=
[d];b.editorPanel.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:c})}})(w=p.FileEditor||(p.FileEditor={}))});
