define("require exports jquery md5 ace w2ui common socket problem spinner tree history project status keys commands".split(" "),function(P,n,l,E,z,F,f,K,L,p,t,M,A,N,O,q){var G=function(){function e(e,f){this.editorBreakpoints={};this.editorMarkers={};this.editorText=this.editorResource=null;this.editorCurrentTokens={};this.editorFocusToken=null;this.editorHistory={};this.editorPanel=null;this.editorPanel=e;this.editorTheme=f}e.prototype.init=function(){O.KeyBinder.bindKeys();A.Project.changeProjectFont();
v.scrollEditorToPosition();v.updateProjectTabOnChange();p.LoadSpinner.finish()};return e}();n.FileEditorView=G;var v;(function(e){function u(){var a=b.editorPanel.getSession(),c;for(c in b.editorMarkers)if(b.editorMarkers.hasOwnProperty(c)){var d=b.editorMarkers[c];null!=d&&a.removeMarker(d)}b.editorMarkers={}}function n(){var a=[],c=1,d;for(d in b.editorBreakpoints)if(b.editorBreakpoints.hasOwnProperty(d)){var e=b.editorBreakpoints[d],f;for(f in e)if(e.hasOwnProperty(f)&&1==e[f]){var g=t.FileTree.createResourcePath(d),
h="\x3cdiv class\x3d'breakpointEnabled'\x3e"+g.projectPath+"\x3c/div\x3e";a.push({recid:c++,name:h,location:"Line "+f,resource:g.projectPath,line:parseInt(f),script:g.resourcePath})}}F.w2ui.breakpoints.records=a;F.w2ui.breakpoints.refresh();q.Command.updateScriptBreakpoints()}function w(){var a;a=b.editorPanel.getSession().getUndoManager();var c=l.extend(!0,{},a.$undoStack),d=l.extend(!0,{},a.$redoStack);a={undoStack:c,redoStack:d,dirtyCounter:a.dirtyCounter};c=b.editorPanel.getSession().getScrollTop();
c=(d=b.editorPanel.selection.getCursor())?{row:d.row,column:d.column,scroll:c}:{scroll:c,row:null,column:null};d=b.editorPanel.getValue();return{breakpoints:b.editorBreakpoints,resource:b.editorResource,history:a,position:c,source:d}}function v(a){a=a.toLowerCase();if(f.Common.stringEndsWith(a,".snap"))return"ace/mode/snapscript";if(f.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";if(f.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(f.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";
if(f.Common.stringEndsWith(a,".pl"))return"ace/mode/perl";if(f.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(f.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(f.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(f.Common.stringEndsWith(a,".java"))return"ace/mode/java";if(f.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(f.Common.stringEndsWith(a,".py"))return"ace/mode/python";if(f.Common.stringEndsWith(a,".html")||f.Common.stringEndsWith(a,".htm"))return"ace/mode/html";
if(f.Common.stringEndsWith(a,".txt"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(f.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".project"))return"ace/mode/xml";f.Common.stringEndsWith(a,".classpath");return"ace/mode/text"}function B(a){a=t.FileTree.createResourcePath(a);return null!=b.editorResource&&b.editorResource.resourcePath==a.resourcePath?w().source:(a=b.editorHistory[a.resourcePath])?a.buffer:
null}function C(){return null!=b.editorResource?b.editorPanel.getValue()!=b.editorText:!1}function H(a){return null!=b.editorResource&&b.editorResource.resourcePath==a?C():B(a)?!0:!1}function I(){var a=b.editorPanel.getSession();if(b.editorResource&&b.editorResource.resourcePath){var c=b.editorHistory[b.editorResource.resourcePath];if(c&&c.position){var d=c.position.scroll,e=c.position.row,c=c.position.column;0<=e&&0<=c?b.editorPanel.selection.moveTo(e,c):b.editorPanel.gotoLine(1);a.setScrollTop(d)}else b.editorPanel.gotoLine(1),
a.setScrollTop(0)}else b.editorPanel.gotoLine(1),a.setScrollTop(0);b.editorPanel.focus()}function D(a){A.Project.markEditorTab(a,H(a))}function J(){return{getCompletions:function(a,c,d,e,f){c=a.getValue();var g=a.session.getLine(d.row);a=b.editorResource.projectPath;g=g.substring(0,d.column);d=JSON.stringify({resource:a,line:d.row+1,complete:g,source:c,prefix:e});l.ajax({contentType:"application/json",data:d,dataType:"json",success:function(a){a=a.tokens;var b=[],d;for(d in a)if(a.hasOwnProperty(d)){var c=
a[d];b.push({className:"autocomplete_"+c,name:d,value:d,score:300,meta:c})}f(null,b)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title})}}}function p(){var a=z.ace.edit("editor"),c=J();a.completers=[c];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");
a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(d){var c=d.domEvent.target;if(-1!=c.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(d.clientX>25+c.getBoundingClientRect().left)){var e=d.getDocumentPosition().row;if(null!=b.editorResource){var g=b.editorPanel.getSession(),c=b.editorBreakpoints[b.editorResource.filePath],f=g.getBreakpoints(),l=!1,k;for(k in f)if(k==
e){l=!0;break}l?g.clearBreakpoint(e):g.setBreakpoint(e);k=parseInt(e);null==c?(c={},c[k+1]=!0,b.editorBreakpoints[b.editorResource.filePath]=c):c[k+1]=1==c[k+1]?!1:!0}n();d.stop()}});"undefined"!==typeof java&&a.setScrollSpeed(.05);return new G(a,editorTheme)}var b=null;e.createEditor=function(){b=p();b.init();K.EventBus.createTermination(u)};e.clearEditorHighlights=u;e.showEditorLine=function(a){b.editorPanel.resize(!0);1<a?(b.editorPanel.scrollToLine(a-1,!0,!0,function(){}),b.editorPanel.gotoLine(a)):
b.editorPanel.scrollToLine(0,!0,!0,function(){});b.editorPanel.focus()};e.createEditorHighlight=function(a,c){var d=z.ace.require("ace/range").Range,e=b.editorPanel.getSession();u();d=e.addMarker(new d(a-1,0,a-1,1),c,"fullLine");b.editorMarkers[a]=d};e.findAndReplaceTextInEditor=function(){var a=w();q.Command.searchAndReplaceFiles(a.resource.projectPath)};e.findTextInEditor=function(){var a=w();q.Command.searchFiles(a.resource.projectPath)};e.addEditorKeyBinding=function(a,c){b.editorPanel.commands.addCommand({name:a.editor,
bindKey:{win:a.editor,mac:a.editor},exec:function(a){c&&c()}})};e.showEditorBreakpoints=n;e.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,c=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+c);b.editorPanel.setAutoScrollEditorIntoView(!0);b.editorPanel.resize(!0)};e.resetEditor=function(){var a=b.editorPanel.getSession();u();b.editorResource=null;b.editorPanel.setReadOnly(!1);a.setValue(b.editorText,1);l("#currentFile").html("")};e.loadEditor=
w;e.resolveEditorMode=v;e.clearSavedEditorBuffer=function(a){a=t.FileTree.createResourcePath(a);var c=b.editorHistory[a.resourcePath];c&&(c.buffer=null,D(a.resourcePath))};e.loadSavedEditorBuffer=B;e.updateEditor=function(a,c){var d=b.editorPanel.getSession(),f=d.getMode(),r=v(c),g=B(c),h=a;g&&(h=g);g=w();if(g.resource&&g.source){var u=E.md5(g.source),k=b.editorPanel.getValue(),k=C()?k:null;b.editorHistory[g.resource.resourcePath]={hash:u,history:g.history,position:g.position,buffer:k}}r!=f&&d.setMode({path:r,
v:Date.now()});b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(h,1);g=h;f=new z.ace.UndoManager;if(g&&c&&(h=t.FileTree.createResourcePath(c),r=b.editorHistory[h.resourcePath]))if(g=E.md5(g),r.hash==g){var h=r.history.undoStack,g=r.history.redoStack,m;for(m in h)h.hasOwnProperty(m)&&(f.$undoStack[m]=h[m]);for(var p in g)g.hasOwnProperty(p)&&(f.$redoStack[p]=h[p]);f.$doc=d;f.dirtyCounter=r.history.dirtyCounter}else b.editorHistory[h.resourcePath]=null;d.setUndoManager(f);var d=b.editorPanel.getSession(),
y;for(y in d.$backMarkers)d.removeMarker(b.editorMarker);y=d.getBreakpoints();for(var x in y)d.clearBreakpoint(x);l("#currentFile").html("");b.editorResource=t.FileTree.createResourcePath(c);b.editorText=a;window.location.hash=b.editorResource.projectPath;L.ProblemManager.highlightProblems();if(null!=c&&b.editorResource&&(x=b.editorBreakpoints[b.editorResource.filePath],null!=x))for(var q in x)x.hasOwnProperty(q)&&1==x[q]&&(m=q-1,null!=b.editorResource&&(y=b.editorPanel.getSession(),d=b.editorBreakpoints[b.editorResource.filePath],
m=parseInt(m),y.setBreakpoint(m),null==d&&(d={},b.editorBreakpoints[b.editorResource.filePath]=d),d[m+1]=!0),n());A.Project.createEditorTab();M.History.showFileHistory();N.StatusPanel.showActiveFile(b.editorResource.projectPath);e.showEditorFileInTree();I();D(b.editorResource.resourcePath)};e.showEditorFileInTree=function(){var a=w().resource;t.FileTree.showTreeNode("explorerTree",a)};e.getCurrentLineForEditor=function(){return b.editorPanel.getSelectionRange().start.row};e.getSelectedText=function(){return b.editorPanel.getSelectedText()};
e.isEditorChanged=C;e.isEditorChangedForPath=H;e.scrollEditorToPosition=I;e.updateProjectTabOnChange=function(){b.editorPanel.on("input",function(){D(b.editorResource.resourcePath)})};e.formatEditorSource=function(){var a=b.editorPanel.getValue();l.ajax({contentType:"text/plain",data:a,success:function(a){b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title+b.editorResource.filePath})};e.setEditorTheme=
function(a){null!=a&&(null!=b.editorPanel&&b.editorPanel.setTheme(a),b.editorTheme=a)};e.updateEditorFont=function(a,c){var d=J();b.editorPanel.completers=[d];b.editorPanel.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:c})}})(v=n.FileEditor||(n.FileEditor={}))});
