define("require exports jquery ace w2ui common socket problem tree history project status keys commands".split(" "),function(U,e,u,w,G,b,O,P,v,Q,z,R,A,B){var H=function(){function a(a){this._editorPanel=a;this._editorHistory={};this._editorMarkers={};this._editorBreakpoints={}}a.prototype.activateEditor=function(){A.KeyBinder.bindKeys();z.Project.changeProjectFont();r.scrollEditorToPosition();r.updateProjectTabOnChange()};a.prototype.updateResourcePath=function(a,p){window.location.hash=a.getProjectPath();
this._editorResource=a;this._editorReadOnly=p};a.prototype.getHistoryForResource=function(a){if(a){a=a.getResourcePath();var f=this._editorHistory[a];f||(f=this._editorHistory[a]=new t(-1,null,null,null,null));return f}return new t(-1,null,null,null,null)};a.prototype.getEditorResource=function(){return this._editorResource};a.prototype.isEditorReadOnly=function(){return this._editorReadOnly};a.prototype.getEditorPanel=function(){return this._editorPanel};a.prototype.getEditorMarkers=function(){return this._editorMarkers};
a.prototype.getEditorBreakpoints=function(){return this._editorBreakpoints};return a}();e.FileEditorView=H;var t=function(){function a(a,p,x,b,q){this._lastModified=a;this._undoState=p;this._position=x;this._originalText=q;this._savedText=b;this._changeMade=!1}a.prototype.restoreUndoManager=function(a,p){var f=new w.ace.UndoManager;if(p==this._savedText&&this._undoState){var b=this._undoState.getUndoStack(),q=this._undoState.getRedoStack(),l;for(l in b)b.hasOwnProperty(l)&&(f.$undoStack[l]=b[l]);
for(var e in q)q.hasOwnProperty(e)&&(f.$redoStack[e]=b[e]);f.$doc=a;f.dirtyCounter=this._undoState.getDirtyCounter()}a.setUndoManager(f)};a.prototype.restoreScrollPosition=function(a,b){if(this._position){var f=this._position.getScroll(),p=this._position.getRow(),e=this._position.getColumn();0<=p&&0<=e?b.selection.moveTo(p,e):b.gotoLine(1);a.setScrollTop(f)}else b.gotoLine(1),a.setScrollTop(0);b.focus()};a.prototype.saveHistory=function(a){a.getSource();this._savedText=a.getSource();this._lastModified=
a.getLastModified();this._undoState=a.getUndoState();this._position=a.getPosition()};a.prototype.updateHistory=function(a,b){a!=this._savedText&&(this._position=this._undoState=null);this._savedText=a;this._originalText=b;this._changeMade=!1};a.prototype.invalidateHistory=function(){this._changeMade=!1;this._undoState=null;this._lastModified=-1;this._savedText=this._originalText=null};a.prototype.touchHistory=function(a){a!=this._savedText&&(this._lastModified=b.Common.currentTime());this._savedText=
a};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getOriginalText=function(){return this._originalText};a.prototype.getSavedText=function(){return this._savedText};return a}();e.FileEditorHistory=t;var I=function(){function a(a,b,e){this._undoStack=a;this._redoStack=b;this._dirtyCounter=e}a.prototype.getUndoStack=function(){return this._undoStack};a.prototype.getRedoStack=function(){return this._redoStack};a.prototype.getDirtyCounter=function(){return this._dirtyCounter};
return a}();e.FileEditorUndoState=I;var J=function(){function a(a,b,e,y,q,l,u){this._lastModified=a;this._breakpoints=b;this._resource=e;this._undoState=y;this._isReadOnly=u;this._position=q;this._source=l}a.prototype.isStateValid=function(){return this._resource&&null!=this._source&&""!=this._source};a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getResource=function(){return this._resource};a.prototype.getPosition=function(){return this._position};a.prototype.getUndoState=
function(){return this._undoState};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getBreakpoints=function(){return this._breakpoints};a.prototype.getSource=function(){return this._source};return a}();e.FileEditorState=J;var C=function(){function a(a,b,e){this._row=a;this._column=b;this._scroll=e}a.prototype.getRow=function(){return this._row};a.prototype.getColumn=function(){return this._column};a.prototype.getScroll=function(){return this._scroll};return a}();e.FileEditorPosition=
C;var D=function(){function a(a,b,e,u){this._lastModified=a;this._isCurrent=u;this._resource=b;this._source=e}a.prototype.isBufferValid=function(){return this._resource&&null!=this._source};a.prototype.isBufferCurrent=function(){return this._isCurrent};a.prototype.getResource=function(){return this._resource};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getSource=function(){return this._source};return a}();e.FileEditorBuffer=D;var r;(function(a){function e(){var c=
d.getEditorPanel().getSession(),a=d.getEditorMarkers();d.getEditorResource();for(var g in a)if(a.hasOwnProperty(g)){var b=a[g];null!=b&&(c.removeMarker(b),delete a[g])}}function p(){var c=d.getEditorBreakpoints(),a=[],g=1,b;for(b in c)if(c.hasOwnProperty(b)){var e=c[b],h;for(h in e)if(e.hasOwnProperty(h)&&1==e[h]){var E=v.FileTree.createResourcePath(b),T="\x3cdiv class\x3d'breakpointEnabled'\x3e"+E.getProjectPath()+"\x3c/div\x3e";a.push({recid:g++,name:T,location:"Line "+h,resource:E.getProjectPath(),
line:parseInt(h),script:E.getResourcePath()})}}G.w2ui.breakpoints.records=a;G.w2ui.breakpoints.refresh();B.Command.updateScriptBreakpoints()}function x(){var c;c=d.getEditorPanel().getSession().getUndoManager();var a=u.extend(!0,{},c.$undoStack),b=u.extend(!0,{},c.$redoStack);c=new I(a,b,c.dirtyCounter);a=d.getEditorPanel().getSession().getScrollTop();a=(b=d.getEditorPanel().selection.getCursor())?new C(b.row,b.column,a):new C(null,null,a);var b=q(),e=-1,m=null;b&&(m=b.getSource(),e=b.getLastModified());
return new J(e,d.getEditorBreakpoints(),d.getEditorResource(),c,a,m,d.isEditorReadOnly())}function y(c){c=c.toLowerCase();if(b.Common.stringEndsWith(c,".snap"))return"ace/mode/snapscript";if(b.Common.stringEndsWith(c,".xml"))return"ace/mode/xml";if(b.Common.stringEndsWith(c,".json"))return"ace/mode/json";if(b.Common.stringEndsWith(c,".sql"))return"ace/mode/sql";if(b.Common.stringEndsWith(c,".pl"))return"ace/mode/perl";if(b.Common.stringEndsWith(c,".kt"))return"ace/mode/kotlin";if(b.Common.stringEndsWith(c,
".js"))return"ace/mode/javascript";if(b.Common.stringEndsWith(c,".ts"))return"ace/mode/typescript";if(b.Common.stringEndsWith(c,".java"))return"ace/mode/java";if(b.Common.stringEndsWith(c,".groovy"))return"ace/mode/groovy";if(b.Common.stringEndsWith(c,".py"))return"ace/mode/python";if(b.Common.stringEndsWith(c,".html")||b.Common.stringEndsWith(c,".htm"))return"ace/mode/html";if(b.Common.stringEndsWith(c,".txt"))return"ace/mode/text";if(b.Common.stringEndsWith(c,".properties"))return"ace/mode/properties";
if(b.Common.stringEndsWith(c,".gitignore"))return"ace/mode/text";if(b.Common.stringEndsWith(c,".project"))return"ace/mode/xml";b.Common.stringEndsWith(c,".classpath");return"ace/mode/text"}function q(){if(d.getEditorResource()){var c=d.getEditorResource().getResourcePath();return l(c)}return null}function l(c){c=v.FileTree.createResourcePath(c);var a=d.getHistoryForResource(c),b=a.getLastModified();return K(c.getResourcePath())?(a=d.getEditorPanel().getValue(),new D(b,c,a,!0)):new D(b,c,a.getSavedText(),
!1)}function r(){return d.getEditorPanel().getSelectionRange().start.row}function t(){if(null!=d.getEditorResource()){var c=d.getHistoryForResource(d.getEditorResource()),a=d.getEditorPanel().getValue(),c=c.getOriginalText();return a!=c}return!1}function L(c){if(K(c))return t();c=v.FileTree.createResourcePath(c);var a=d.getHistoryForResource(c);c=a.getOriginalText();a=a.getSavedText();return c!=a}function K(a){return null!=d.getEditorResource()&&d.getEditorResource().getResourcePath()==a?!0:!1}function M(){var a=
d.getEditorPanel().getSession();d.getHistoryForResource(d.getEditorResource()).restoreScrollPosition(a,d.getEditorPanel())}function F(a){z.Project.markEditorTab(a,L(a))}function N(){return{getCompletions:function(a,e,g,S,m){e=a.getValue();var c=a.session.getLine(g.row);a=d.getEditorResource().getProjectPath();c=c.substring(0,g.column);g=JSON.stringify({resource:a,line:g.row+1,complete:c,source:e,prefix:S});u.ajax({contentType:"application/json",data:g,dataType:"json",success:function(a){var c=a.expression,
d=Math.max(0,c.lastIndexOf(".")+1);a=a.tokens;var e=[],g;for(g in a)if(a.hasOwnProperty(g)){var n=a[g];b.Common.stringStartsWith(g,c)&&(g=g.substring(d));e.push({className:"autocomplete_"+n,token:g,value:g,score:300,meta:n})}m(null,e)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title})}}}function A(){var a=w.ace.edit("editor"),b=N();a.completers=[b];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);
a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(c){var b=c.domEvent.target;if(-1!=b.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(c.clientX>25+b.getBoundingClientRect().left)){var e=c.getDocumentPosition().row,b=d.getEditorBreakpoints();
if(null!=d.getEditorResource()){var g=d.getEditorPanel().getSession(),n=b[d.getEditorResource().getFilePath()],f=g.getBreakpoints(),l=!1,k;for(k in f)if(k==e){l=!0;break}l?g.clearBreakpoint(e):g.setBreakpoint(e);k=parseInt(e);null==n?(n={},n[k+1]=!0,b[d.getEditorResource().getFilePath()]=n):n[k+1]=1==n[k+1]?!1:!0}p();c.stop()}});"undefined"!==typeof java&&a.setScrollSpeed(.05);return new H(a)}var d=null;a.createEditor=function(){d=A();d.activateEditor();O.EventBus.createTermination(e)};a.clearEditorHighlights=
e;a.showEditorLine=function(a){d.getEditorPanel();d.getEditorPanel().resize(!0);if(1<a){var c=a-1;r()!=c&&(d.getEditorPanel().scrollToLine(c,!0,!0,function(){}),d.getEditorPanel().gotoLine(a),d.getEditorPanel().focus())}else d.getEditorPanel().scrollToLine(0,!0,!0,function(){}),d.getEditorPanel().focus()};a.createEditorHighlight=function(a,b){var c=w.ace.require("ace/range").Range,n=d.getEditorPanel().getSession(),m=d.getEditorMarkers();e();c=n.addMarker(new c(a-1,0,a-1,1),b,"fullLine");m[a]=c};a.createMultipleEditorHighlights=
function(a,b){var c=w.ace.require("ace/range").Range,n=d.getEditorPanel().getSession(),m=d.getEditorMarkers();e();for(var h=0;h<a.length;h++){var f=a[h],l=n.addMarker(new c(f-1,0,f-1,1),b,"fullLine");m[f]=l}};a.findAndReplaceTextInEditor=function(){var a=x().getResource();B.Command.searchAndReplaceFiles(a.getProjectPath())};a.findTextInEditor=function(){var a=x().getResource();B.Command.searchFiles(a.getProjectPath())};a.addEditorKeyBinding=function(a,b){d.getEditorPanel().commands.addCommand({name:a.editor,
bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};a.showEditorBreakpoints=p;a.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+b);d.getEditorPanel().setAutoScrollEditorIntoView(!0);d.getEditorPanel().resize(!0)};a.currentEditorState=x;a.resolveEditorMode=y;a.clearSavedEditorBuffer=function(a){var c=v.FileTree.createResourcePath(a);d.getHistoryForResource(c).invalidateHistory();
F(a)};a.currrentEditorBuffer=q;a.getEditorBufferForResource=l;a.updateEditor=function(c){var b=c.getResourcePath(),g=c.isHistorical()||c.isError(),f=c.getFileContent(),m;m=c.getFileContent();var h=c.isHistorical()||c.isError();console.log("resource\x3d["+c.getResourcePath().getResourcePath()+"] modified\x3d["+c.getTimeStamp()+"] length\x3d["+c.getFileLength()+"] readonly\x3d["+h+"]");h?console.log("IGNORE HISTORY WHEN READ ONLY"):(h=l(c.getResourcePath().getResourcePath()),h.getSource()&&h.getLastModified()>
c.getLastModified()?(console.log("LOAD FROM HISTORY diff\x3d["+(h.getLastModified()-c.getLastModified())+"]"),m=h.getSource()):console.log("IGNORE HISTORY: ",h));c=d.getEditorPanel().getSession();var h=c.getMode(),q=y(b.getResourcePath()),r=x();if(!r.isReadOnly()){var t=r.getResource(),t=d.getHistoryForResource(t);r.isStateValid()?t.saveHistory(r):t.invalidateHistory()}q!=h&&c.setMode({path:q,v:Date.now()});g?(f=m,d.getEditorPanel().setReadOnly(!1),d.getEditorPanel().setValue(f,1)):(h=d.getHistoryForResource(b),
d.getEditorPanel().setReadOnly(!1),d.getEditorPanel().setValue(m,1),h.updateHistory(m,f),h.restoreUndoManager(c,m));var f=d.getEditorPanel().getSession(),k;for(k in f.$backMarkers)f.removeMarker(k);e();k=f.getBreakpoints();for(var v in k)f.clearBreakpoint(v);u("#currentFile").html("");d.getEditorPanel().setReadOnly(g);d.updateResourcePath(b,g);P.ProblemManager.highlightProblems();if(null!=b&&d.getEditorResource()&&(b=d.getEditorResource().getFilePath(),b=d.getEditorBreakpoints()[b],null!=b))for(var w in b)b.hasOwnProperty(w)&&
1==b[w]&&(f=parseInt(w)-1,g=d.getEditorBreakpoints(),null!=d.getEditorResource()&&(v=d.getEditorPanel().getSession(),k=g[d.getEditorResource().getFilePath()],f=parseInt(f),v.setBreakpoint(f),null==k&&(k={},g[d.getEditorResource().getFilePath()]=k),k[f+1]=!0),p());z.Project.createEditorTab();Q.History.showFileHistory();R.StatusPanel.showActiveFile(d.getEditorResource().getProjectPath());a.showEditorFileInTree();M();F(d.getEditorResource().getResourcePath())};a.showEditorFileInTree=function(){var a=
x().getResource();v.FileTree.showTreeNode("explorerTree",a)};a.getCurrentLineForEditor=r;a.getSelectedText=function(){return d.getEditorPanel().getSelectedText()};a.isEditorChanged=t;a.isEditorChangedForPath=L;a.scrollEditorToPosition=M;a.updateProjectTabOnChange=function(){d.getEditorPanel().on("input",function(){var a=d.getEditorResource(),a=d.getHistoryForResource(a),b=d.getEditorPanel().getValue();a.touchHistory(b);F(d.getEditorResource().getResourcePath())})};a.formatEditorSource=function(){var a=
d.getEditorPanel().getValue(),b=d.getEditorResource().getFilePath();u.ajax({contentType:"text/plain",data:a,success:function(a){d.getEditorPanel().setReadOnly(!1);d.getEditorPanel().setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title+b})};a.setEditorTheme=function(a){null!=a&&null!=d.getEditorPanel()&&d.getEditorPanel().setTheme(a)};a.updateEditorFont=function(a,b){var c=N();d.getEditorPanel().completers=[c];d.getEditorPanel().setOptions({enableBasicAutocompletion:!0,
fontFamily:"'"+a+"',monospace",fontSize:b})}})(r=e.FileEditor||(e.FileEditor={}))});
