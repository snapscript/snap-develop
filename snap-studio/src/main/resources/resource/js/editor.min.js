define("require exports jquery md5 ace w2ui common socket problem spinner tree history project status keys commands".split(" "),function(Q,p,m,F,z,G,g,L,M,x,r,N,A,O,P,q){var H=function(){function c(c,g){this.editorBreakpoints={};this.editorMarkers={};this.editorText=this.editorResource=null;this.editorCurrentTokens={};this.editorFocusToken=null;this.editorHistory={};this.editorPanel=null;this.editorPanel=c;this.editorTheme=g}c.prototype.init=function(){P.KeyBinder.bindKeys();A.Project.changeProjectFont();
u.scrollEditorToPosition();u.updateProjectTabOnChange();x.LoadSpinner.finish()};return c}();p.FileEditorView=H;var u;(function(c){function t(){var a=b.editorPanel.getSession(),d;for(d in b.editorMarkers)if(b.editorMarkers.hasOwnProperty(d)){var e=b.editorMarkers[d];null!=e&&a.removeMarker(e)}b.editorMarkers={}}function p(){var a=[],d=1,e;for(e in b.editorBreakpoints)if(b.editorBreakpoints.hasOwnProperty(e)){var c=b.editorBreakpoints[e],h;for(h in c)if(c.hasOwnProperty(h)&&1==c[h]){var f=r.FileTree.createResourcePath(e),
k="\x3cdiv class\x3d'breakpointEnabled'\x3e"+f.projectPath+"\x3c/div\x3e";a.push({recid:d++,name:k,location:"Line "+h,resource:f.projectPath,line:parseInt(h),script:f.resourcePath})}}G.w2ui.breakpoints.records=a;G.w2ui.breakpoints.refresh();q.Command.updateScriptBreakpoints()}function v(){var a;a=b.editorPanel.getSession().getUndoManager();var d=m.extend(!0,{},a.$undoStack),e=m.extend(!0,{},a.$redoStack);a={undoStack:d,redoStack:e,dirtyCounter:a.dirtyCounter};d=b.editorPanel.getSession().getScrollTop();
d=(e=b.editorPanel.selection.getCursor())?{row:e.row,column:e.column,scroll:d}:{scroll:d,row:null,column:null};e=b.editorPanel.getValue();return{breakpoints:b.editorBreakpoints,resource:b.editorResource,history:a,position:d,source:e}}function u(a){a=a.toLowerCase();if(g.Common.stringEndsWith(a,".snap"))return"ace/mode/snapscript";if(g.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";if(g.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(g.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";
if(g.Common.stringEndsWith(a,".pl"))return"ace/mode/perl";if(g.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(g.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(g.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(g.Common.stringEndsWith(a,".java"))return"ace/mode/java";if(g.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(g.Common.stringEndsWith(a,".py"))return"ace/mode/python";if(g.Common.stringEndsWith(a,".html")||g.Common.stringEndsWith(a,".htm"))return"ace/mode/html";
if(g.Common.stringEndsWith(a,".txt"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(g.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".project"))return"ace/mode/xml";g.Common.stringEndsWith(a,".classpath");return"ace/mode/text"}function B(a){a=r.FileTree.createResourcePath(a);return null!=b.editorResource&&b.editorResource.resourcePath==a.resourcePath?v().source:(a=b.editorHistory[a.resourcePath])?a.buffer:
null}function C(){return null!=b.editorResource?b.editorPanel.getValue()!=b.editorText:!1}function I(a){return null!=b.editorResource&&b.editorResource.resourcePath==a?C():B(a)?!0:!1}function J(){var a=b.editorPanel.getSession();if(b.editorResource&&b.editorResource.resourcePath){var d=b.editorHistory[b.editorResource.resourcePath];if(d&&d.position){var e=d.position.scroll,c=d.position.row,d=d.position.column;0<=c&&0<=d?b.editorPanel.selection.moveTo(c,d):b.editorPanel.gotoLine(1);a.setScrollTop(e)}else b.editorPanel.gotoLine(1),
a.setScrollTop(0)}else b.editorPanel.gotoLine(1),a.setScrollTop(0);b.editorPanel.focus()}function D(a){A.Project.markEditorTab(a,I(a))}function K(){return{getCompletions:function(a,d,e,c,h){d=a.getValue();var f=a.session.getLine(e.row);a=b.editorResource.projectPath;f=f.substring(0,e.column);e=JSON.stringify({resource:a,line:e.row+1,complete:f,source:d,prefix:c});m.ajax({contentType:"application/json",data:e,dataType:"json",success:function(a){var b=a.expression,e=Math.max(0,b.lastIndexOf(".")+1);
a=a.tokens;var d=[],c;for(c in a)if(a.hasOwnProperty(c)){var f=a[c];g.Common.stringStartsWith(c,b)&&(c=c.substring(e));d.push({className:"autocomplete_"+f,token:c,value:c,score:300,meta:f})}h(null,d)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title})}}}function x(){var a=z.ace.edit("editor"),d=K();a.completers=[d];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);
a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(e){var d=e.domEvent.target;if(-1!=d.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(e.clientX>25+d.getBoundingClientRect().left)){var c=e.getDocumentPosition().row;if(null!=b.editorResource){var f=b.editorPanel.getSession(),
d=b.editorBreakpoints[b.editorResource.filePath],g=f.getBreakpoints(),m=!1,l;for(l in g)if(l==c){m=!0;break}m?f.clearBreakpoint(c):f.setBreakpoint(c);l=parseInt(c);null==d?(d={},d[l+1]=!0,b.editorBreakpoints[b.editorResource.filePath]=d):d[l+1]=1==d[l+1]?!1:!0}p();e.stop()}});"undefined"!==typeof java&&a.setScrollSpeed(.05);return new H(a,editorTheme)}var b=null;c.createEditor=function(){b=x();b.init();L.EventBus.createTermination(t)};c.clearEditorHighlights=t;c.showEditorLine=function(a){b.editorPanel.resize(!0);
1<a?(b.editorPanel.scrollToLine(a-1,!0,!0,function(){}),b.editorPanel.gotoLine(a)):b.editorPanel.scrollToLine(0,!0,!0,function(){});b.editorPanel.focus()};c.createEditorHighlight=function(a,d){var c=z.ace.require("ace/range").Range,g=b.editorPanel.getSession();t();c=g.addMarker(new c(a-1,0,a-1,1),d,"fullLine");b.editorMarkers[a]=c};c.createMultipleEditorHighlights=function(a,d){var c=z.ace.require("ace/range").Range,g=b.editorPanel.getSession();t();for(var h=0;h<a.length;h++){var f=a[h],k=g.addMarker(new c(f-
1,0,f-1,1),d,"fullLine");b.editorMarkers[f]=k}};c.findAndReplaceTextInEditor=function(){var a=v();q.Command.searchAndReplaceFiles(a.resource.projectPath)};c.findTextInEditor=function(){var a=v();q.Command.searchFiles(a.resource.projectPath)};c.addEditorKeyBinding=function(a,d){b.editorPanel.commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){d&&d()}})};c.showEditorBreakpoints=p;c.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,d=document.getElementById("editor").offsetHeight;
console.log("Resize editor "+a+"x"+d);b.editorPanel.setAutoScrollEditorIntoView(!0);b.editorPanel.resize(!0)};c.resetEditor=function(){var a=b.editorPanel.getSession();t();b.editorResource=null;b.editorPanel.setReadOnly(!1);a.setValue(b.editorText,1);m("#currentFile").html("")};c.loadEditor=v;c.resolveEditorMode=u;c.clearSavedEditorBuffer=function(a){a=r.FileTree.createResourcePath(a);var d=b.editorHistory[a.resourcePath];d&&(d.buffer=null,D(a.resourcePath))};c.loadSavedEditorBuffer=B;c.updateEditor=
function(a,d){var e=b.editorPanel.getSession(),g=e.getMode(),h=u(d),f=B(d),k=a;f&&(k=f);f=v();if(f.resource&&f.source){var x=F.md5(f.source),l=b.editorPanel.getValue(),l=C()?l:null;b.editorHistory[f.resource.resourcePath]={hash:x,history:f.history,position:f.position,buffer:l}}h!=g&&e.setMode({path:h,v:Date.now()});b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(k,1);f=k;g=new z.ace.UndoManager;if(f&&d&&(k=r.FileTree.createResourcePath(d),h=b.editorHistory[k.resourcePath]))if(f=F.md5(f),h.hash==
f){var k=h.history.undoStack,f=h.history.redoStack,n;for(n in k)k.hasOwnProperty(n)&&(g.$undoStack[n]=k[n]);for(var q in f)f.hasOwnProperty(q)&&(g.$redoStack[q]=k[q]);g.$doc=e;g.dirtyCounter=h.history.dirtyCounter}else b.editorHistory[k.resourcePath]=null;e.setUndoManager(g);var e=b.editorPanel.getSession(),y;for(y in e.$backMarkers)e.removeMarker(b.editorMarker);t();y=e.getBreakpoints();for(var w in y)e.clearBreakpoint(w);m("#currentFile").html("");b.editorResource=r.FileTree.createResourcePath(d);
b.editorText=a;window.location.hash=b.editorResource.projectPath;M.ProblemManager.highlightProblems();if(null!=d&&b.editorResource&&(w=b.editorBreakpoints[b.editorResource.filePath],null!=w))for(var E in w)w.hasOwnProperty(E)&&1==w[E]&&(n=E-1,null!=b.editorResource&&(y=b.editorPanel.getSession(),e=b.editorBreakpoints[b.editorResource.filePath],n=parseInt(n),y.setBreakpoint(n),null==e&&(e={},b.editorBreakpoints[b.editorResource.filePath]=e),e[n+1]=!0),p());A.Project.createEditorTab();N.History.showFileHistory();
O.StatusPanel.showActiveFile(b.editorResource.projectPath);c.showEditorFileInTree();J();D(b.editorResource.resourcePath)};c.showEditorFileInTree=function(){var a=v().resource;r.FileTree.showTreeNode("explorerTree",a)};c.getCurrentLineForEditor=function(){return b.editorPanel.getSelectionRange().start.row};c.getSelectedText=function(){return b.editorPanel.getSelectedText()};c.isEditorChanged=C;c.isEditorChangedForPath=I;c.scrollEditorToPosition=J;c.updateProjectTabOnChange=function(){b.editorPanel.on("input",
function(){D(b.editorResource.resourcePath)})};c.formatEditorSource=function(){var a=b.editorPanel.getValue();m.ajax({contentType:"text/plain",data:a,success:function(a){b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title+b.editorResource.filePath})};c.setEditorTheme=function(a){null!=a&&(null!=b.editorPanel&&b.editorPanel.setTheme(a),b.editorTheme=a)};c.updateEditorFont=function(a,c){var d=
K();b.editorPanel.completers=[d];b.editorPanel.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:c})}})(u=p.FileEditor||(p.FileEditor={}))});
