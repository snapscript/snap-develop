define("require exports jquery md5 ace w2ui common socket problem spinner tree history project status keys commands".split(" "),function(R,q,u,G,A,H,f,M,N,r,v,O,B,P,Q,t){var I=function(){function e(e,f){this.editorBreakpoints={};this.editorMarkers={};this.editorTheme=this.editorLastModified=this.editorText=this.editorResource=null;this.editorCurrentTokens={};this.editorFocusToken=null;this.editorHistory={};this.editorPanel=null;this.editorLastModified=(new Date).getTime();this.editorPanel=e;this.editorTheme=
f}e.prototype.init=function(){Q.KeyBinder.bindKeys();B.Project.changeProjectFont();x.scrollEditorToPosition();x.updateProjectTabOnChange();r.LoadSpinner.finish()};return e}();q.FileEditorView=I;var x;(function(e){function w(){var a=b.editorPanel.getSession(),d;for(d in b.editorMarkers)if(b.editorMarkers.hasOwnProperty(d)){var c=b.editorMarkers[d];null!=c&&a.removeMarker(c)}b.editorMarkers={}}function q(){var a=[],d=1,c;for(c in b.editorBreakpoints)if(b.editorBreakpoints.hasOwnProperty(c)){var e=b.editorBreakpoints[c],
h;for(h in e)if(e.hasOwnProperty(h)&&1==e[h]){var f=v.FileTree.createResourcePath(c),k="\x3cdiv class\x3d'breakpointEnabled'\x3e"+f.projectPath+"\x3c/div\x3e";a.push({recid:d++,name:k,location:"Line "+h,resource:f.projectPath,line:parseInt(h),script:f.resourcePath})}}H.w2ui.breakpoints.records=a;H.w2ui.breakpoints.refresh();t.Command.updateScriptBreakpoints()}function y(){var a;a=b.editorPanel.getSession().getUndoManager();var d=u.extend(!0,{},a.$undoStack),c=u.extend(!0,{},a.$redoStack);a={undoStack:d,
redoStack:c,dirtyCounter:a.dirtyCounter};d=b.editorPanel.getSession().getScrollTop();d=(c=b.editorPanel.selection.getCursor())?{row:c.row,column:c.column,scroll:d}:{scroll:d,row:null,column:null};c=b.editorPanel.getValue();return{lastModified:b.editorLastModified,breakpoints:b.editorBreakpoints,resource:b.editorResource,history:a,position:d,source:c}}function x(a){a=a.toLowerCase();if(f.Common.stringEndsWith(a,".snap"))return"ace/mode/snapscript";if(f.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";
if(f.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(f.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";if(f.Common.stringEndsWith(a,".pl"))return"ace/mode/perl";if(f.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(f.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(f.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(f.Common.stringEndsWith(a,".java"))return"ace/mode/java";if(f.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(f.Common.stringEndsWith(a,
".py"))return"ace/mode/python";if(f.Common.stringEndsWith(a,".html")||f.Common.stringEndsWith(a,".htm"))return"ace/mode/html";if(f.Common.stringEndsWith(a,".txt"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(f.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".project"))return"ace/mode/xml";f.Common.stringEndsWith(a,".classpath");return"ace/mode/text"}function C(a){a=v.FileTree.createResourcePath(a);return null!=
b.editorResource&&b.editorResource.resourcePath==a.resourcePath?(a=y(),{buffer:a.source,lastModified:a.lastModified}):(a=b.editorHistory[a.resourcePath])?{buffer:a.buffer,lastModified:a.lastModified}:null}function D(){return null!=b.editorResource?b.editorPanel.getValue()!=b.editorText:!1}function J(a){return null!=b.editorResource&&b.editorResource.resourcePath==a?D():C(a).buffer?!0:!1}function K(){var a=b.editorPanel.getSession();if(b.editorResource&&b.editorResource.resourcePath){var d=b.editorHistory[b.editorResource.resourcePath];
if(d&&d.position){var c=d.position.scroll,e=d.position.row,d=d.position.column;0<=e&&0<=d?b.editorPanel.selection.moveTo(e,d):b.editorPanel.gotoLine(1);a.setScrollTop(c)}else b.editorPanel.gotoLine(1),a.setScrollTop(0)}else b.editorPanel.gotoLine(1),a.setScrollTop(0);b.editorPanel.focus()}function E(a){B.Project.markEditorTab(a,J(a))}function L(){return{getCompletions:function(a,d,c,e,h){d=a.getValue();var g=a.session.getLine(c.row);a=b.editorResource.projectPath;g=g.substring(0,c.column);c=JSON.stringify({resource:a,
line:c.row+1,complete:g,source:d,prefix:e});u.ajax({contentType:"application/json",data:c,dataType:"json",success:function(a){var b=a.expression,d=Math.max(0,b.lastIndexOf(".")+1);a=a.tokens;var c=[],e;for(e in a)if(a.hasOwnProperty(e)){var g=a[e];f.Common.stringStartsWith(e,b)&&(e=e.substring(d));c.push({className:"autocomplete_"+g,token:e,value:e,score:300,meta:g})}h(null,c)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title})}}}
function r(){var a=A.ace.edit("editor"),d=L();a.completers=[d];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(d){var c=d.domEvent.target;
if(-1!=c.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(d.clientX>25+c.getBoundingClientRect().left)){var e=d.getDocumentPosition().row;if(null!=b.editorResource){var f=b.editorPanel.getSession(),c=b.editorBreakpoints[b.editorResource.filePath],k=f.getBreakpoints(),l=!1,m;for(m in k)if(m==e){l=!0;break}l?f.clearBreakpoint(e):f.setBreakpoint(e);m=parseInt(e);null==c?(c={},c[m+1]=!0,b.editorBreakpoints[b.editorResource.filePath]=c):c[m+1]=1==c[m+1]?!1:!0}q();d.stop()}});"undefined"!==typeof java&&
a.setScrollSpeed(.05);return new I(a,editorTheme)}var b=null;e.createEditor=function(){b=r();b.init();M.EventBus.createTermination(w)};e.clearEditorHighlights=w;e.showEditorLine=function(a){b.editorPanel.resize(!0);1<a?(b.editorPanel.scrollToLine(a-1,!0,!0,function(){}),b.editorPanel.gotoLine(a)):b.editorPanel.scrollToLine(0,!0,!0,function(){});b.editorPanel.focus()};e.createEditorHighlight=function(a,d){var c=A.ace.require("ace/range").Range,e=b.editorPanel.getSession();w();c=e.addMarker(new c(a-
1,0,a-1,1),d,"fullLine");b.editorMarkers[a]=c};e.createMultipleEditorHighlights=function(a,d){var c=A.ace.require("ace/range").Range,e=b.editorPanel.getSession();w();for(var f=0;f<a.length;f++){var n=a[f],k=e.addMarker(new c(n-1,0,n-1,1),d,"fullLine");b.editorMarkers[n]=k}};e.findAndReplaceTextInEditor=function(){var a=y();t.Command.searchAndReplaceFiles(a.resource.projectPath)};e.findTextInEditor=function(){var a=y();t.Command.searchFiles(a.resource.projectPath)};e.addEditorKeyBinding=function(a,
d){b.editorPanel.commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){d&&d()}})};e.showEditorBreakpoints=q;e.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,d=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+d);b.editorPanel.setAutoScrollEditorIntoView(!0);b.editorPanel.resize(!0)};e.resetEditor=function(){var a=b.editorPanel.getSession();w();b.editorResource=null;b.editorPanel.setReadOnly(!1);a.setValue(b.editorText,
1);u("#currentFile").html("")};e.loadEditor=y;e.resolveEditorMode=x;e.clearSavedEditorBuffer=function(a){a=v.FileTree.createResourcePath(a);var d=b.editorHistory[a.resourcePath];d&&(d.lastModified=-1,d.buffer=null,E(a.resourcePath))};e.loadSavedEditorBuffer=C;e.updateEditor=function(a,d,c){console.log("resource\x3d["+d+"] modified\x3d["+f.Common.formatTimeMillis(c)+"] length\x3d["+(a?a.length:"NULL")+"]");var g=b.editorPanel.getSession(),h=g.getMode(),n=x(d),k;a:if(a){var l=d.toLowerCase();if(f.Common.stringEndsWith(l,
".json"))try{var m=JSON.parse(a);k=JSON.stringify(m,null,3);break a}catch(S){}k=a}else k="";l=C(d);a=k;l&&l.buffer&&l.lastModified>c?(console.log("LOAD FROM HISTORY diff\x3d["+(l.lastModified-c)+"]"),a=l.buffer):console.log("IGNORE HISTORY: ",l);c=y();c.resource&&c.source&&(l=G.md5(c.source),m=b.editorPanel.getValue(),m=D()?m:null,b.editorHistory[c.resource.resourcePath]={hash:l,lastModified:c.lastModified,history:c.history,position:c.position,buffer:m});n!=h&&g.setMode({path:n,v:Date.now()});b.editorPanel.setReadOnly(!1);
b.editorPanel.setValue(a,1);c=a;h=new A.ace.UndoManager;if(c&&d&&(a=v.FileTree.createResourcePath(d),n=b.editorHistory[a.resourcePath]))if(c=G.md5(c),n.hash==c){a=n.history.undoStack;c=n.history.redoStack;for(var r in a)a.hasOwnProperty(r)&&(h.$undoStack[r]=a[r]);for(var t in c)c.hasOwnProperty(t)&&(h.$redoStack[t]=a[t]);h.$doc=g;h.dirtyCounter=n.history.dirtyCounter}else b.editorHistory[a.resourcePath]=null;g.setUndoManager(h);var g=b.editorPanel.getSession(),p;for(p in g.$backMarkers)g.removeMarker(b.editorMarker);
w();p=g.getBreakpoints();for(var z in p)g.clearBreakpoint(z);u("#currentFile").html("");b.editorResource=v.FileTree.createResourcePath(d);b.editorText=k;window.location.hash=b.editorResource.projectPath;N.ProblemManager.highlightProblems();if(null!=d&&b.editorResource&&(d=b.editorBreakpoints[b.editorResource.filePath],null!=d))for(var F in d)d.hasOwnProperty(F)&&1==d[F]&&(p=F-1,null!=b.editorResource&&(k=b.editorPanel.getSession(),z=b.editorBreakpoints[b.editorResource.filePath],p=parseInt(p),k.setBreakpoint(p),
null==z&&(z={},b.editorBreakpoints[b.editorResource.filePath]=z),z[p+1]=!0),q());B.Project.createEditorTab();O.History.showFileHistory();P.StatusPanel.showActiveFile(b.editorResource.projectPath);e.showEditorFileInTree();K();E(b.editorResource.resourcePath)};e.showEditorFileInTree=function(){var a=y().resource;v.FileTree.showTreeNode("explorerTree",a)};e.getCurrentLineForEditor=function(){return b.editorPanel.getSelectionRange().start.row};e.getSelectedText=function(){return b.editorPanel.getSelectedText()};
e.isEditorChanged=D;e.isEditorChangedForPath=J;e.scrollEditorToPosition=K;e.updateProjectTabOnChange=function(){b.editorPanel.on("input",function(){b.editorLastModified=(new Date).getTime();E(b.editorResource.resourcePath)})};e.formatEditorSource=function(){var a=b.editorPanel.getValue();u.ajax({contentType:"text/plain",data:a,success:function(a){b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title+
b.editorResource.filePath})};e.setEditorTheme=function(a){null!=a&&(null!=b.editorPanel&&b.editorPanel.setTheme(a),b.editorTheme=a)};e.updateEditorFont=function(a,d){var c=L();b.editorPanel.completers=[c];b.editorPanel.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:d})}})(x=q.FileEditor||(q.FileEditor={}))});
