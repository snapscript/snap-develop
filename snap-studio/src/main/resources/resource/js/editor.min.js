define("require exports jquery ace w2ui common socket problem tree history project status keys commands".split(" "),function(R,e,x,z,G,d,N,O,t,P,A,Q,B,C){var H=function(){function a(a){this._editorPanel=a;this._editorHistory={};this._editorMarkers={};this._editorBreakpoints={}}a.prototype.activateEditor=function(){B.KeyBinder.bindKeys();A.Project.changeProjectFont();q.scrollEditorToPosition();q.updateProjectTabOnChange()};a.prototype.updateResourcePath=function(a){window.location.hash=a.getProjectPath();
this._editorResource=a};a.prototype.getHistoryForResource=function(a){if(a){a=a.getResourcePath();var g=this._editorHistory[a];g||(g=this._editorHistory[a]=new m(-1,null,null,null,null));return g}return new m(-1,null,null,null,null)};a.prototype.getEditorResource=function(){return this._editorResource};a.prototype.getEditorPanel=function(){return this._editorPanel};a.prototype.getEditorMarkers=function(){return this._editorMarkers};a.prototype.getEditorBreakpoints=function(){return this._editorBreakpoints};
return a}();e.FileEditorView=H;var m=function(){function a(a,h,u,d,l){this._lastModified=a;this._undoState=h;this._position=u;this._originalText=l;this._savedText=d;this._changeMade=!1}a.prototype.restoreUndoManager=function(a,d){var g=new z.ace.UndoManager;if(d==this._savedText&&this._undoState){var h=this._undoState.getUndoStack(),l=this._undoState.getRedoStack(),k;for(k in h)h.hasOwnProperty(k)&&(g.$undoStack[k]=h[k]);for(var e in l)l.hasOwnProperty(e)&&(g.$redoStack[e]=h[e]);g.$doc=a;g.dirtyCounter=
this._undoState.getDirtyCounter()}a.setUndoManager(g)};a.prototype.restoreScrollPosition=function(a,h){if(this._position){var g=this._position.getScroll(),d=this._position.getRow(),e=this._position.getColumn();0<=d&&0<=e?h.selection.moveTo(d,e):h.gotoLine(1);a.setScrollTop(g)}else h.gotoLine(1),a.setScrollTop(0);h.focus()};a.prototype.saveHistory=function(a){a.getSource();this._savedText=a.getSource();this._lastModified=a.getLastModified();this._undoState=a.getUndoState();this._position=a.getPosition()};
a.prototype.updateHistory=function(a,d){a!=this._savedText&&(this._position=this._undoState=null);this._savedText=a;this._originalText=d;this._changeMade=!1};a.prototype.invalidateHistory=function(){this._changeMade=!1;this._undoState=null;this._lastModified=-1;this._savedText=this._originalText=null};a.prototype.touchHistory=function(a){a!=this._savedText&&(this._lastModified=d.Common.currentTime());this._savedText=a};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getOriginalText=
function(){return this._originalText};a.prototype.getSavedText=function(){return this._savedText};return a}();e.FileEditorHistory=m;var I=function(){function a(a,d,e){this._undoStack=a;this._redoStack=d;this._dirtyCounter=e}a.prototype.getUndoStack=function(){return this._undoStack};a.prototype.getRedoStack=function(){return this._redoStack};a.prototype.getDirtyCounter=function(){return this._dirtyCounter};return a}();e.FileEditorUndoState=I;var J=function(){function a(a,d,e,w,l,k){this._lastModified=
a;this._breakpoints=d;this._resource=e;this._undoState=w;this._position=l;this._source=k}a.prototype.isStateValid=function(){return this._resource&&null!=this._source&&""!=this._source};a.prototype.getResource=function(){return this._resource};a.prototype.getPosition=function(){return this._position};a.prototype.getUndoState=function(){return this._undoState};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getBreakpoints=function(){return this._breakpoints};a.prototype.getSource=
function(){return this._source};return a}();e.FileEditorState=J;var D=function(){function a(a,d,e){this._row=a;this._column=d;this._scroll=e}a.prototype.getRow=function(){return this._row};a.prototype.getColumn=function(){return this._column};a.prototype.getScroll=function(){return this._scroll};return a}();e.FileEditorPosition=D;var E=function(){function a(a,d,e,w){this._lastModified=a;this._isCurrent=w;this._resource=d;this._source=e}a.prototype.isBufferValid=function(){return this._resource&&null!=
this._source};a.prototype.isBufferCurrent=function(){return this._isCurrent};a.prototype.getResource=function(){return this._resource};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getSource=function(){return this._source};return a}();e.FileEditorBuffer=E;var q;(function(a){function e(){var b=c.getEditorPanel().getSession(),a=c.getEditorMarkers();c.getEditorResource();for(var f in a)if(a.hasOwnProperty(f)){var d=a[f];null!=d&&(b.removeMarker(d),delete a[f])}}function h(){var b=
c.getEditorBreakpoints(),a=[],f=1,d;for(d in b)if(b.hasOwnProperty(d)){var e=b[d],y;for(y in e)if(e.hasOwnProperty(y)&&1==e[y]){var v=t.FileTree.createResourcePath(d),h="\x3cdiv class\x3d'breakpointEnabled'\x3e"+v.getProjectPath()+"\x3c/div\x3e";a.push({recid:f++,name:h,location:"Line "+y,resource:v.getProjectPath(),line:parseInt(y),script:v.getResourcePath()})}}G.w2ui.breakpoints.records=a;G.w2ui.breakpoints.refresh();C.Command.updateScriptBreakpoints()}function u(){var b;b=c.getEditorPanel().getSession().getUndoManager();
var a=x.extend(!0,{},b.$undoStack),f=x.extend(!0,{},b.$redoStack);b=new I(a,f,b.dirtyCounter);a=c.getEditorPanel().getSession().getScrollTop();a=(f=c.getEditorPanel().selection.getCursor())?new D(f.row,f.column,a):new D(null,null,a);var f=l(),d=-1,e=null;f&&(e=f.getSource(),d=f.getLastModified());return new J(d,c.getEditorBreakpoints(),c.getEditorResource(),b,a,e)}function w(b){b=b.toLowerCase();if(d.Common.stringEndsWith(b,".snap"))return"ace/mode/snapscript";if(d.Common.stringEndsWith(b,".xml"))return"ace/mode/xml";
if(d.Common.stringEndsWith(b,".json"))return"ace/mode/json";if(d.Common.stringEndsWith(b,".sql"))return"ace/mode/sql";if(d.Common.stringEndsWith(b,".pl"))return"ace/mode/perl";if(d.Common.stringEndsWith(b,".kt"))return"ace/mode/kotlin";if(d.Common.stringEndsWith(b,".js"))return"ace/mode/javascript";if(d.Common.stringEndsWith(b,".ts"))return"ace/mode/typescript";if(d.Common.stringEndsWith(b,".java"))return"ace/mode/java";if(d.Common.stringEndsWith(b,".groovy"))return"ace/mode/groovy";if(d.Common.stringEndsWith(b,
".py"))return"ace/mode/python";if(d.Common.stringEndsWith(b,".html")||d.Common.stringEndsWith(b,".htm"))return"ace/mode/html";if(d.Common.stringEndsWith(b,".txt"))return"ace/mode/text";if(d.Common.stringEndsWith(b,".properties"))return"ace/mode/properties";if(d.Common.stringEndsWith(b,".gitignore"))return"ace/mode/text";if(d.Common.stringEndsWith(b,".project"))return"ace/mode/xml";d.Common.stringEndsWith(b,".classpath");return"ace/mode/text"}function l(){if(c.getEditorResource()){var b=c.getEditorResource().getResourcePath();
return k(b)}return null}function k(b){b=t.FileTree.createResourcePath(b);var a=c.getHistoryForResource(b),f=a.getLastModified();return K(b.getResourcePath())?(a=c.getEditorPanel().getValue(),new E(f,b,a,!0)):new E(f,b,a.getSavedText(),!1)}function q(){if(null!=c.getEditorResource()){var b=c.getHistoryForResource(c.getEditorResource());return c.getEditorPanel().getValue()!=b.getOriginalText()}return!1}function m(b){if(K(b))return q();b=t.FileTree.createResourcePath(b);var a=c.getHistoryForResource(b);
b=a.getOriginalText();a=a.getSavedText();return b!=a}function K(a){return null!=c.getEditorResource()&&c.getEditorResource().getResourcePath()==a?!0:!1}function L(){var a=c.getEditorPanel().getSession();c.getHistoryForResource(c.getEditorResource()).restoreScrollPosition(a,c.getEditorPanel())}function F(a){A.Project.markEditorTab(a,m(a))}function M(){return{getCompletions:function(a,e,f,h,p){e=a.getValue();var b=a.session.getLine(f.row);a=c.getEditorResource().getProjectPath();b=b.substring(0,f.column);
f=JSON.stringify({resource:a,line:f.row+1,complete:b,source:e,prefix:h});x.ajax({contentType:"application/json",data:f,dataType:"json",success:function(a){var b=a.expression,c=Math.max(0,b.lastIndexOf(".")+1);a=a.tokens;var f=[],e;for(e in a)if(a.hasOwnProperty(e)){var n=a[e];d.Common.stringStartsWith(e,b)&&(e=e.substring(c));f.push({className:"autocomplete_"+n,token:e,value:e,score:300,meta:n})}p(null,f)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+
document.title})}}}function B(){var a=z.ace.edit("editor"),e=M();a.completers=[e];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(b){var e=
b.domEvent.target;if(-1!=e.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(b.clientX>25+e.getBoundingClientRect().left)){var f=b.getDocumentPosition().row,e=c.getEditorBreakpoints();if(null!=c.getEditorResource()){var d=c.getEditorPanel().getSession(),n=e[c.getEditorResource().getFilePath()],g=d.getBreakpoints(),k=!1,r;for(r in g)if(r==f){k=!0;break}k?d.clearBreakpoint(f):d.setBreakpoint(f);r=parseInt(f);null==n?(n={},n[r+1]=!0,e[c.getEditorResource().getFilePath()]=n):n[r+1]=1==n[r+1]?!1:
!0}h();b.stop()}});"undefined"!==typeof java&&a.setScrollSpeed(.05);return new H(a)}var c=null;a.createEditor=function(){c=B();c.activateEditor();N.EventBus.createTermination(e)};a.clearEditorHighlights=e;a.showEditorLine=function(a){c.getEditorPanel();c.getEditorPanel().resize(!0);1<a?(c.getEditorPanel().scrollToLine(a-1,!0,!0,function(){}),c.getEditorPanel().gotoLine(a)):c.getEditorPanel().scrollToLine(0,!0,!0,function(){});c.getEditorPanel().focus()};a.createEditorHighlight=function(a,d){var b=
z.ace.require("ace/range").Range,n=c.getEditorPanel().getSession(),h=c.getEditorMarkers();e();b=n.addMarker(new b(a-1,0,a-1,1),d,"fullLine");h[a]=b};a.createMultipleEditorHighlights=function(a,d){var b=z.ace.require("ace/range").Range,n=c.getEditorPanel().getSession(),h=c.getEditorMarkers();e();for(var g=0;g<a.length;g++){var k=a[g],l=n.addMarker(new b(k-1,0,k-1,1),d,"fullLine");h[k]=l}};a.findAndReplaceTextInEditor=function(){var a=u().getResource();C.Command.searchAndReplaceFiles(a.getProjectPath())};
a.findTextInEditor=function(){var a=u().getResource();C.Command.searchFiles(a.getProjectPath())};a.addEditorKeyBinding=function(a,e){c.getEditorPanel().commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){e&&e()}})};a.showEditorBreakpoints=h;a.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,e=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+e);c.getEditorPanel().setAutoScrollEditorIntoView(!0);c.getEditorPanel().resize(!0)};
a.currentEditorState=u;a.resolveEditorMode=w;a.clearSavedEditorBuffer=function(a){var b=t.FileTree.createResourcePath(a);c.getHistoryForResource(b).invalidateHistory();F(a)};a.currrentEditorBuffer=l;a.getEditorBufferForResource=k;a.updateEditor=function(b){var d=b.getResourcePath(),f=b.getFileContent(),g;console.log("resource\x3d["+b.getResourcePath().getResourcePath()+"] modified\x3d["+b.getTimeStamp()+"] length\x3d["+b.getFileLength()+"]");g=b.getFileContent();var p=k(b.getResourcePath().getResourcePath());
p.getSource()&&p.getLastModified()>b.getLastModified()?(console.log("LOAD FROM HISTORY diff\x3d["+(p.getLastModified()-b.getLastModified())+"]"),g=p.getSource()):console.log("IGNORE HISTORY: ",p);b=c.getEditorPanel().getSession();var p=b.getMode(),l=w(d.getResourcePath()),v=u(),q=v.getResource(),q=c.getHistoryForResource(q);v.isStateValid()?q.saveHistory(v):q.invalidateHistory();l!=p&&b.setMode({path:l,v:Date.now()});p=c.getHistoryForResource(d);c.getEditorPanel().setReadOnly(!1);c.getEditorPanel().setValue(g,
1);p.updateHistory(g,f);p.restoreUndoManager(b,g);var f=c.getEditorPanel().getSession(),m;for(m in f.$backMarkers)f.removeMarker(m);e();m=f.getBreakpoints();for(var r in m)f.clearBreakpoint(r);x("#currentFile").html("");c.updateResourcePath(d);O.ProblemManager.highlightProblems();if(null!=d&&c.getEditorResource()&&(d=c.getEditorResource().getFilePath(),d=c.getEditorBreakpoints()[d],null!=d))for(var t in d)d.hasOwnProperty(t)&&1==d[t]&&(b=parseInt(t)-1,r=c.getEditorBreakpoints(),null!=c.getEditorResource()&&
(m=c.getEditorPanel().getSession(),f=r[c.getEditorResource().getFilePath()],b=parseInt(b),m.setBreakpoint(b),null==f&&(f={},r[c.getEditorResource().getFilePath()]=f),f[b+1]=!0),h());A.Project.createEditorTab();P.History.showFileHistory();Q.StatusPanel.showActiveFile(c.getEditorResource().getProjectPath());a.showEditorFileInTree();L();F(c.getEditorResource().getResourcePath())};a.showEditorFileInTree=function(){var a=u().getResource();t.FileTree.showTreeNode("explorerTree",a)};a.getCurrentLineForEditor=
function(){return c.getEditorPanel().getSelectionRange().start.row};a.getSelectedText=function(){return c.getEditorPanel().getSelectedText()};a.isEditorChanged=q;a.isEditorChangedForPath=m;a.scrollEditorToPosition=L;a.updateProjectTabOnChange=function(){c.getEditorPanel().on("input",function(){var a=c.getEditorResource(),a=c.getHistoryForResource(a),d=c.getEditorPanel().getValue();a.touchHistory(d);F(c.getEditorResource().getResourcePath())})};a.formatEditorSource=function(){var a=c.getEditorPanel().getValue(),
d=c.getEditorResource().getFilePath();x.ajax({contentType:"text/plain",data:a,success:function(a){c.getEditorPanel().setReadOnly(!1);c.getEditorPanel().setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title+d})};a.setEditorTheme=function(a){null!=a&&null!=c.getEditorPanel()&&c.getEditorPanel().setTheme(a)};a.updateEditorFont=function(a,d){var b=M();c.getEditorPanel().completers=[b];c.getEditorPanel().setOptions({enableBasicAutocompletion:!0,
fontFamily:"'"+a+"',monospace",fontSize:d})}})(q=e.FileEditor||(e.FileEditor={}))});
