define("require exports jquery ace w2ui common socket problem tree history project status keys commands".split(" "),function(W,e,v,x,I,b,S,T,w,U,A,V,B,C){var J=function(){function a(a){this._editorPanel=a;this._editorHistory={};this._editorMarkers={};this._editorBreakpoints={}}a.prototype.activateEditor=function(){B.KeyBinder.bindKeys();A.Project.changeProjectFont();y.scrollEditorToPosition();y.updateProjectTabOnChange()};a.prototype.updateResourcePath=function(a,k){window.location.hash=a.getProjectPath();
this._editorResource=a;this._editorReadOnly=k};a.prototype.getHistoryForResource=function(a){if(a){a=a.getResourcePath();var p=this._editorHistory[a];p||(p=this._editorHistory[a]=new z(-1,null,null,null,null));return p}return new z(-1,null,null,null,null)};a.prototype.getEditorResource=function(){return this._editorResource};a.prototype.isEditorReadOnly=function(){return this._editorReadOnly};a.prototype.getEditorPanel=function(){return this._editorPanel};a.prototype.getEditorMarkers=function(){return this._editorMarkers};
a.prototype.getEditorBreakpoints=function(){return this._editorBreakpoints};return a}();e.FileEditorView=J;var D=function(){function a(a,k,h){this._style=k;this._line=a;this._marker=h}a.prototype.getLine=function(){return this._line};a.prototype.getMarker=function(){return this._marker};a.prototype.getStyle=function(){return this._style};return a}();e.FileEditorMarker=D;var z=function(){function a(a,k,h,b,q){this._lastModified=a;this._undoState=k;this._position=h;this._originalText=q;this._savedText=
b;this._changeMade=!1}a.prototype.restoreUndoManager=function(a,k){var p=new x.ace.UndoManager;if(k==this._savedText&&this._undoState){var b=this._undoState.getUndoStack(),q=this._undoState.getRedoStack(),u;for(u in b)b.hasOwnProperty(u)&&(p.$undoStack[u]=b[u]);for(var e in q)q.hasOwnProperty(e)&&(p.$redoStack[e]=b[e]);p.$doc=a;p.dirtyCounter=this._undoState.getDirtyCounter()}a.setUndoManager(p)};a.prototype.restoreScrollPosition=function(a,b){if(this._position){var p=this._position.getScroll(),k=
this._position.getRow(),e=this._position.getColumn();0<=k&&0<=e?b.selection.moveTo(k,e):b.gotoLine(1);a.setScrollTop(p)}else b.gotoLine(1),a.setScrollTop(0);b.focus()};a.prototype.saveHistory=function(a){a.getSource();this._savedText=a.getSource();this._lastModified=a.getLastModified();this._undoState=a.getUndoState();this._position=a.getPosition()};a.prototype.updateHistory=function(a,b){a!=this._savedText&&(this._position=this._undoState=null);this._savedText=a;this._originalText=b;this._changeMade=
!1};a.prototype.invalidateHistory=function(){this._changeMade=!1;this._undoState=null;this._lastModified=-1;this._savedText=this._originalText=null};a.prototype.touchHistory=function(a){a!=this._savedText&&(this._lastModified=b.Common.currentTime());this._savedText=a};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getOriginalText=function(){return this._originalText};a.prototype.getSavedText=function(){return this._savedText};return a}();e.FileEditorHistory=z;var K=
function(){function a(a,b,h){this._undoStack=a;this._redoStack=b;this._dirtyCounter=h}a.prototype.getUndoStack=function(){return this._undoStack};a.prototype.getRedoStack=function(){return this._redoStack};a.prototype.getDirtyCounter=function(){return this._dirtyCounter};return a}();e.FileEditorUndoState=K;var L=function(){function a(a,b,h,e,q,u,v){this._lastModified=a;this._breakpoints=b;this._resource=h;this._undoState=e;this._isReadOnly=v;this._position=q;this._source=u}a.prototype.isStateValid=
function(){return this._resource&&null!=this._source&&""!=this._source};a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getResource=function(){return this._resource};a.prototype.getPosition=function(){return this._position};a.prototype.getUndoState=function(){return this._undoState};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getBreakpoints=function(){return this._breakpoints};a.prototype.getSource=function(){return this._source};return a}();
e.FileEditorState=L;var E=function(){function a(a,b,e){this._row=a;this._column=b;this._scroll=e}a.prototype.getRow=function(){return this._row};a.prototype.getColumn=function(){return this._column};a.prototype.getScroll=function(){return this._scroll};return a}();e.FileEditorPosition=E;var F=function(){function a(a,b,e,v){this._lastModified=a;this._isCurrent=v;this._resource=b;this._source=e}a.prototype.isBufferValid=function(){return this._resource&&null!=this._source};a.prototype.isBufferCurrent=
function(){return this._isCurrent};a.prototype.getResource=function(){return this._resource};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getSource=function(){return this._source};return a}();e.FileEditorBuffer=F;var y;(function(a){function e(){var c=d.getEditorPanel().getSession(),a=d.getEditorMarkers();d.getEditorResource();for(var f in a)if(a.hasOwnProperty(f)){var b=a[f];null!=b&&(c.removeMarker(b.getMarker()),delete a[f])}}function k(){var c=d.getEditorBreakpoints(),
a=[],f=1,b;for(b in c)if(c.hasOwnProperty(b)){var e=c[b],g;for(g in e)if(e.hasOwnProperty(g)&&1==e[g]){var G=w.FileTree.createResourcePath(b),m="\x3cdiv class\x3d'breakpointEnabled'\x3e"+G.getProjectPath()+"\x3c/div\x3e";a.push({recid:f++,name:m,location:"Line "+g,resource:G.getProjectPath(),line:parseInt(g),script:G.getResourcePath()})}}I.w2ui.breakpoints.records=a;I.w2ui.breakpoints.refresh();C.Command.updateScriptBreakpoints()}function h(){var c;c=d.getEditorPanel().getSession().getUndoManager();
var a=v.extend(!0,{},c.$undoStack),b=v.extend(!0,{},c.$redoStack);c=new K(a,b,c.dirtyCounter);a=d.getEditorPanel().getSession().getScrollTop();a=(b=d.getEditorPanel().selection.getCursor())?new E(b.row,b.column,a):new E(null,null,a);var b=q(),e=-1,l=null;b&&(l=b.getSource(),e=b.getLastModified());return new L(e,d.getEditorBreakpoints(),d.getEditorResource(),c,a,l,d.isEditorReadOnly())}function y(c){c=c.toLowerCase();if(b.Common.stringEndsWith(c,".snap"))return"ace/mode/snapscript";if(b.Common.stringEndsWith(c,
".xml"))return"ace/mode/xml";if(b.Common.stringEndsWith(c,".json"))return"ace/mode/json";if(b.Common.stringEndsWith(c,".sql"))return"ace/mode/sql";if(b.Common.stringEndsWith(c,".pl"))return"ace/mode/perl";if(b.Common.stringEndsWith(c,".kt"))return"ace/mode/kotlin";if(b.Common.stringEndsWith(c,".js"))return"ace/mode/javascript";if(b.Common.stringEndsWith(c,".ts"))return"ace/mode/typescript";if(b.Common.stringEndsWith(c,".java"))return"ace/mode/java";if(b.Common.stringEndsWith(c,".groovy"))return"ace/mode/groovy";
if(b.Common.stringEndsWith(c,".py"))return"ace/mode/python";if(b.Common.stringEndsWith(c,".html")||b.Common.stringEndsWith(c,".htm"))return"ace/mode/html";if(b.Common.stringEndsWith(c,".txt"))return"ace/mode/text";if(b.Common.stringEndsWith(c,".properties"))return"ace/mode/properties";if(b.Common.stringEndsWith(c,".gitignore"))return"ace/mode/text";if(b.Common.stringEndsWith(c,".project"))return"ace/mode/xml";b.Common.stringEndsWith(c,".classpath");return"ace/mode/text"}function q(){if(d.getEditorResource()){var c=
d.getEditorResource().getResourcePath();return u(c)}return null}function u(c){c=w.FileTree.createResourcePath(c);var a=d.getHistoryForResource(c),b=a.getLastModified();return M(c.getResourcePath())?(a=d.getEditorPanel().getValue(),new F(b,c,a,!0)):new F(b,c,a.getSavedText(),!1)}function z(a){d.getEditorPanel().setReadOnly(a)}function N(){return d.getEditorPanel().getSelectionRange().start.row}function O(){if(null!=d.getEditorResource()){var a=d.getHistoryForResource(d.getEditorResource()),b=d.getEditorPanel().getValue(),
a=a.getOriginalText();return b!=a}return!1}function P(a){if(M(a))return O();a=w.FileTree.createResourcePath(a);var c=d.getHistoryForResource(a);a=c.getOriginalText();c=c.getSavedText();return a!=c}function M(a){return null!=d.getEditorResource()&&d.getEditorResource().getResourcePath()==a?!0:!1}function Q(){var a=d.getEditorPanel().getSession();d.getHistoryForResource(d.getEditorResource()).restoreScrollPosition(a,d.getEditorPanel())}function H(a){A.Project.markEditorTab(a,P(a))}function R(){return{getCompletions:function(a,
r,f,e,l){r=a.getValue();var c=a.session.getLine(f.row);a=d.getEditorResource().getProjectPath();c=c.substring(0,f.column);f=JSON.stringify({resource:a,line:f.row+1,complete:c,source:r,prefix:e});v.ajax({contentType:"application/json",data:f,dataType:"json",success:function(a){var c=a.expression,d=Math.max(0,c.lastIndexOf(".")+1);a=a.tokens;var r=[],e;for(e in a)if(a.hasOwnProperty(e)){var f=a[e];b.Common.stringStartsWith(e,c)&&(e=e.substring(d));r.push({className:"autocomplete_"+f,token:e,value:e,
score:300,meta:f})}l(null,r)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title})}}}function B(){var a=x.ace.edit("editor"),b=R();a.completers=[b];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");
a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(c){var b=c.domEvent.target;if(-1!=b.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(c.clientX>25+b.getBoundingClientRect().left)){var e=c.getDocumentPosition().row,b=d.getEditorBreakpoints();if(null!=d.getEditorResource()){var r=d.getEditorPanel().getSession(),f=b[d.getEditorResource().getFilePath()],m=r.getBreakpoints(),h=!1,n;for(n in m)if(n==e){h=!0;break}h?r.clearBreakpoint(e):r.setBreakpoint(e);
n=parseInt(e);null==f?(f={},f[n+1]=!0,b[d.getEditorResource().getFilePath()]=f):f[n+1]=1==f[n+1]?!1:!0}k();c.stop()}});"undefined"!==typeof java&&a.setScrollSpeed(.05);return new J(a)}var d=null;a.createEditor=function(){d=B();d.activateEditor();S.EventBus.createTermination(e)};a.clearEditorHighlights=e;a.showEditorLine=function(a){d.getEditorPanel();d.getEditorPanel().resize(!0);if(1<a){var c=a-1;N()!=c&&(d.getEditorPanel().scrollToLine(c,!0,!0,function(){}),d.getEditorPanel().gotoLine(a),d.getEditorPanel().focus())}else d.getEditorPanel().scrollToLine(0,
!0,!0,function(){}),d.getEditorPanel().focus()};a.createEditorHighlight=function(a,b){var c=x.ace.require("ace/range").Range,r=d.getEditorPanel().getSession(),l=d.getEditorMarkers(),g=l[a];e();c=r.addMarker(new c(a-1,0,a-1,1),b,"fullLine");c=new D(a,b,c);l[a]=c;return g?g.getStyle()!=b:!1};a.createMultipleEditorHighlights=function(a,b){for(var c=x.ace.require("ace/range").Range,r=d.getEditorPanel().getSession(),l=d.getEditorMarkers(),g=!1,h=0;h<a.length;h++){var m=a[h];(m=l[m])?m.getStyle()!=b&&(g=
!0):g=!0}e();for(h=0;h<a.length;h++){var m=a[h],k=r.addMarker(new c(m-1,0,m-1,1),b,"fullLine"),k=new D(m,b,k);l[m]=k}return g};a.findAndReplaceTextInEditor=function(){var a=h().getResource();C.Command.searchAndReplaceFiles(a.getProjectPath())};a.findTextInEditor=function(){var a=h().getResource();C.Command.searchFiles(a.getProjectPath())};a.addEditorKeyBinding=function(a,b){d.getEditorPanel().commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};a.showEditorBreakpoints=
k;a.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+b);d.getEditorPanel().setAutoScrollEditorIntoView(!0);d.getEditorPanel().resize(!0)};a.currentEditorState=h;a.resolveEditorMode=y;a.clearSavedEditorBuffer=function(a){var c=w.FileTree.createResourcePath(a);d.getHistoryForResource(c).invalidateHistory();H(a)};a.currrentEditorBuffer=q;a.getEditorBufferForResource=u;a.updateEditor=function(c){var b=
c.getResourcePath(),f=c.isHistorical()||c.isError(),t=c.getFileContent(),l;l=c.getFileContent();var g=c.isHistorical()||c.isError();console.log("resource\x3d["+c.getResourcePath().getResourcePath()+"] modified\x3d["+c.getTimeStamp()+"] length\x3d["+c.getFileLength()+"] readonly\x3d["+g+"]");g?console.log("IGNORE HISTORY WHEN READ ONLY"):(g=u(c.getResourcePath().getResourcePath()),g.getSource()&&g.getLastModified()>c.getLastModified()?(console.log("LOAD FROM HISTORY diff\x3d["+(g.getLastModified()-
c.getLastModified())+"]"),l=g.getSource()):console.log("IGNORE HISTORY: ",g));c=d.getEditorPanel().getSession();var g=c.getMode(),p=y(b.getResourcePath()),m=h();if(!m.isReadOnly()){var q=m.getResource(),q=d.getHistoryForResource(q);m.isStateValid()?q.saveHistory(m):q.invalidateHistory()}p!=g&&c.setMode({path:p,v:Date.now()});f?(t=l,d.getEditorPanel().setReadOnly(!1),d.getEditorPanel().setValue(t,1)):(g=d.getHistoryForResource(b),d.getEditorPanel().setReadOnly(!1),d.getEditorPanel().setValue(l,1),
g.updateHistory(l,t),g.restoreUndoManager(c,l));var t=d.getEditorPanel().getSession(),n;for(n in t.$backMarkers)t.removeMarker(n);e();n=t.getBreakpoints();for(var w in n)t.clearBreakpoint(w);v("#currentFile").html("");z(f);d.updateResourcePath(b,f);T.ProblemManager.highlightProblems();if(null!=b&&d.getEditorResource()&&(b=d.getEditorResource().getFilePath(),b=d.getEditorBreakpoints()[b],null!=b))for(var x in b)b.hasOwnProperty(x)&&1==b[x]&&(t=parseInt(x)-1,f=d.getEditorBreakpoints(),null!=d.getEditorResource()&&
(w=d.getEditorPanel().getSession(),n=f[d.getEditorResource().getFilePath()],t=parseInt(t),w.setBreakpoint(t),null==n&&(n={},f[d.getEditorResource().getFilePath()]=n),n[t+1]=!0),k());A.Project.createEditorTab();U.History.showFileHistory();V.StatusPanel.showActiveFile(d.getEditorResource().getProjectPath());a.showEditorFileInTree();Q();H(d.getEditorResource().getResourcePath())};a.focusEditor=function(){d.getEditorPanel().focus()};a.setReadOnly=z;a.showEditorFileInTree=function(){var a=h().getResource();
w.FileTree.showTreeNode("explorerTree",a)};a.getCurrentLineForEditor=N;a.getSelectedText=function(){return d.getEditorPanel().getSelectedText()};a.isEditorChanged=O;a.isEditorChangedForPath=P;a.scrollEditorToPosition=Q;a.updateProjectTabOnChange=function(){d.getEditorPanel().on("input",function(){var a=d.getEditorResource(),a=d.getHistoryForResource(a),b=d.getEditorPanel().getValue();a.touchHistory(b);H(d.getEditorResource().getResourcePath())})};a.formatEditorSource=function(){var a=d.getEditorPanel().getValue(),
b=d.getEditorResource().getFilePath();v.ajax({contentType:"text/plain",data:a,success:function(a){d.getEditorPanel().setReadOnly(!1);d.getEditorPanel().setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title+b})};a.setEditorTheme=function(a){null!=a&&null!=d.getEditorPanel()&&d.getEditorPanel().setTheme(a)};a.updateEditorFont=function(a,b){var c=R();d.getEditorPanel().completers=[c];d.getEditorPanel().setOptions({enableBasicAutocompletion:!0,
fontFamily:"'"+a+"',monospace",fontSize:b})}})(y=e.FileEditor||(e.FileEditor={}))});
