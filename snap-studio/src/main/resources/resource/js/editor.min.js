define("require exports jquery md5 ace w2ui common socket problem spinner tree history project status keys commands".split(" "),function(S,l,x,H,A,I,f,O,P,B,y,Q,C,R,w,D){var J=function(){function e(e,f){this.editorBreakpoints={};this.editorMarkers={};this.editorText=this.editorResource=null;this.editorCurrentTokens={};this.editorFocusToken=null;this.editorHistory={};this.editorPanel=null;this.editorPanel=e;this.editorTheme=f}e.prototype.init=function(){w.KeyBinder.bindKeys();C.Project.changeProjectFont();
n.scrollEditorToPosition();n.updateProjectTabOnChange();B.LoadSpinner.finish()};return e}();l.FileEditorView=J;var n;(function(e){function r(){var a=b.editorPanel.getSession(),d;for(d in b.editorMarkers)if(b.editorMarkers.hasOwnProperty(d)){var c=b.editorMarkers[d];null!=c&&a.removeMarker(c)}b.editorMarkers={}}function l(a){b.editorPanel.resize(!0);1<a?(b.editorPanel.scrollToLine(a-1,!0,!0,function(){}),b.editorPanel.gotoLine(a)):b.editorPanel.scrollToLine(0,!0,!0,function(){});b.editorPanel.focus()}
function n(){var a=[],d=1,c;for(c in b.editorBreakpoints)if(b.editorBreakpoints.hasOwnProperty(c)){var m=b.editorBreakpoints[c],e;for(e in m)if(m.hasOwnProperty(e)&&1==m[e]){var k=y.FileTree.createResourcePath(c),f="\x3cdiv class\x3d'breakpointEnabled'\x3e"+k.projectPath+"\x3c/div\x3e";a.push({recid:d++,name:f,location:"Line "+e,resource:k.projectPath,line:parseInt(e),script:k.resourcePath})}}I.w2ui.breakpoints.records=a;I.w2ui.breakpoints.refresh();D.Command.updateScriptBreakpoints()}function z(){var a;
a=b.editorPanel.getSession().getUndoManager();var d=x.extend(!0,{},a.$undoStack),c=x.extend(!0,{},a.$redoStack);a={undoStack:d,redoStack:c,dirtyCounter:a.dirtyCounter};d=b.editorPanel.getSession().getScrollTop();d=(c=b.editorPanel.selection.getCursor())?{row:c.row,column:c.column,scroll:d}:{scroll:d,row:null,column:null};c=b.editorPanel.getValue();return{breakpoints:b.editorBreakpoints,resource:b.editorResource,history:a,position:d,source:c}}function K(a){a=a.toLowerCase();if(f.Common.stringEndsWith(a,
".snap"))return"ace/mode/snapscript";if(f.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";if(f.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(f.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";if(f.Common.stringEndsWith(a,".pl"))return"ace/mode/perl";if(f.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(f.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(f.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(f.Common.stringEndsWith(a,".java"))return"ace/mode/java";
if(f.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(f.Common.stringEndsWith(a,".py"))return"ace/mode/python";if(f.Common.stringEndsWith(a,".html")||f.Common.stringEndsWith(a,".htm"))return"ace/mode/html";if(f.Common.stringEndsWith(a,".txt"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(f.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".project"))return"ace/mode/xml";f.Common.stringEndsWith(a,
".classpath");return"ace/mode/text"}function B(a,d){var c=d.toLowerCase(),e=/(function|static|public|private|abstract|override|)\s+([a-z][a-zA-Z0-9]*)\s*\(/g,q=/(var|const)\s+([a-z][a-zA-Z0-9]*)/g,k=/(class|trait|enum)\s+([A-Z][a-zA-Z0-9]*)/g,p=/import\s+([a-z][a-zA-Z0-9\.]*)\.([A-Z][a-zA-Z]*)/g,g={};if(f.Common.stringEndsWith(c,".snap"))for(var c=a.split(/\r?\n/),h=0;h<c.length;h++){var t=c[h];u(t,h+1,e,g,["%s("],!1);u(t,h+1,q,g,"%s.;%s\x3d;%s \x3d;%s\x3c;%s \x3c;%s\x3e;%s \x3e;%s!;%s !;%s-;%s -;%s+;%s +;%s*;%s *;%s%;%s %;%s/;%s /".split(";"),
!1);u(t,h+1,p,g,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!0);u(t,h+1,k,g,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!1)}b.editorCurrentTokens=g;if(null!=b.editorFocusToken){var n=b.editorCurrentTokens[b.editorFocusToken];null!=n&&(setTimeout(function(){l(n.line)},100),b.editorFocusToken=null)}}function u(a,b,c,e,f,k){c.lastIndex=0;c=c.exec(a);if(null!=c&&0<c.length){a=c[1];c=c[2];for(var d=0;d<f.length;d++){var g=
f[d].replace("%s",c);e[g]=k?{resource:"/"+a.replace(".","/")+".snap",line:b}:{resource:null,line:b}}}}function E(a){a=y.FileTree.createResourcePath(a);return null!=b.editorResource&&b.editorResource.resourcePath==a.resourcePath?z().source:(a=b.editorHistory[a.resourcePath])?a.buffer:null}function F(){return null!=b.editorResource?b.editorPanel.getValue()!=b.editorText:!1}function L(a){return null!=b.editorResource&&b.editorResource.resourcePath==a?F():E(a)?!0:!1}function M(){var a=b.editorPanel.getSession();
if(b.editorResource&&b.editorResource.resourcePath){var d=b.editorHistory[b.editorResource.resourcePath];if(d&&d.position){var c=d.position.scroll,e=d.position.row,d=d.position.column;0<=e&&0<=d?b.editorPanel.selection.moveTo(e,d):b.editorPanel.gotoLine(1);a.setScrollTop(c)}else b.editorPanel.gotoLine(1),a.setScrollTop(0)}else b.editorPanel.gotoLine(1),a.setScrollTop(0);b.editorPanel.focus()}function G(a){C.Project.markEditorTab(a,L(a))}function N(){return{getCompletions:function(a,d,c,e,f){d=a.getValue();
var k=a.session.getLine(c.row);a=b.editorResource.projectPath;k=k.substring(0,c.column);c=JSON.stringify({resource:a,line:c.row+1,complete:k,source:d,prefix:e});x.ajax({contentType:"application/json",data:c,dataType:"json",success:function(a){a=a.tokens;var b=[],c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push({className:"autocomplete_"+d,name:c,value:c,score:300,meta:d})}f(null,b)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title})}}}
function w(){var a=A.ace.edit("editor"),d=N();a.completers=[d];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(c){var d=c.domEvent.target;
if(-1!=d.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(c.clientX>25+d.getBoundingClientRect().left)){var e=c.getDocumentPosition().row;if(null!=b.editorResource){var f=b.editorPanel.getSession(),d=b.editorBreakpoints[b.editorResource.filePath],p=f.getBreakpoints(),g=!1,h;for(h in p)if(h==e){g=!0;break}g?f.clearBreakpoint(e):f.setBreakpoint(e);h=parseInt(e);null==d?(d={},d[h+1]=!0,b.editorBreakpoints[b.editorResource.filePath]=d):d[h+1]=1==d[h+1]?!1:!0}n();c.stop()}});"undefined"!==typeof java&&
a.setScrollSpeed(.05);return new J(a,editorTheme)}var b=null;e.createEditor=function(){b=w();b.init();O.EventBus.createTermination(r)};e.clearEditorHighlights=r;e.showEditorLine=l;e.createEditorHighlight=function(a,d){var c=A.ace.require("ace/range").Range,e=b.editorPanel.getSession();r();c=e.addMarker(new c(a-1,0,a-1,1),d,"fullLine");b.editorMarkers[a]=c};e.findAndReplaceTextInEditor=function(){var a=z();D.Command.searchAndReplaceFiles(a.resource.projectPath)};e.findTextInEditor=function(){var a=
z();D.Command.searchFiles(a.resource.projectPath)};e.addEditorKeyBinding=function(a,d){b.editorPanel.commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){d&&d()}})};e.showEditorBreakpoints=n;e.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,d=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+d);b.editorPanel.setAutoScrollEditorIntoView(!0);b.editorPanel.resize(!0)};e.resetEditor=function(){var a=b.editorPanel.getSession();
r();b.editorResource=null;b.editorPanel.setReadOnly(!1);a.setValue(b.editorText,1);x("#currentFile").html("")};e.loadEditor=z;e.resolveEditorMode=K;e.clearSavedEditorBuffer=function(a){a=y.FileTree.createResourcePath(a);var d=b.editorHistory[a.resourcePath];d&&(d.buffer=null,G(a.resourcePath))};e.loadSavedEditorBuffer=E;e.updateEditor=function(a,d){var c=b.editorPanel.getSession(),m=c.getMode(),q=K(d),k;a:if(a){var p=d.toLowerCase();if(f.Common.stringEndsWith(p,".json"))try{var g=JSON.parse(a);k=
JSON.stringify(g,null,3);break a}catch(T){}k=a}else k="";g=E(d);p=k;g&&(p=g);g=z();if(g.resource&&g.source){var h=H.md5(g.source),t=b.editorPanel.getValue(),t=F()?t:null;b.editorHistory[g.resource.resourcePath]={hash:h,history:g.history,position:g.position,buffer:t}}q!=m&&c.setMode({path:q,v:Date.now()});b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(p,1);h=p;m=new A.ace.UndoManager;if(h&&d&&(g=y.FileTree.createResourcePath(d),q=b.editorHistory[g.resourcePath]))if(h=H.md5(h),q.hash==h){var g=
q.history.undoStack,h=q.history.redoStack,l;for(l in g)g.hasOwnProperty(l)&&(m.$undoStack[l]=g[l]);for(var r in h)h.hasOwnProperty(r)&&(m.$redoStack[r]=g[r]);m.$doc=c;m.dirtyCounter=q.history.dirtyCounter}else b.editorHistory[g.resourcePath]=null;c.setUndoManager(m);var c=b.editorPanel.getSession(),v;for(v in c.$backMarkers)c.removeMarker(b.editorMarker);v=c.getBreakpoints();for(var u in v)c.clearBreakpoint(u);x("#currentFile").html("");b.editorResource=y.FileTree.createResourcePath(d);b.editorText=
k;window.location.hash=b.editorResource.projectPath;P.ProblemManager.highlightProblems();if(null!=d&&b.editorResource&&(k=b.editorBreakpoints[b.editorResource.filePath],null!=k))for(var w in k)k.hasOwnProperty(w)&&1==k[w]&&(c=w-1,null!=b.editorResource&&(u=b.editorPanel.getSession(),v=b.editorBreakpoints[b.editorResource.filePath],c=parseInt(c),u.setBreakpoint(c),null==v&&(v={},b.editorBreakpoints[b.editorResource.filePath]=v),v[c+1]=!0),n());B(p,d);C.Project.createEditorTab();Q.History.showFileHistory();
R.StatusPanel.showActiveFile(b.editorResource.projectPath);e.showEditorFileInTree();M();G(b.editorResource.resourcePath)};e.showEditorFileInTree=function(){var a=z().resource;y.FileTree.showTreeNode("explorerTree",a)};e.getCurrentLineForEditor=function(){return b.editorPanel.getSelectionRange().start.row};e.getSelectedText=function(){return b.editorPanel.getSelectedText()};e.isEditorChanged=F;e.isEditorChangedForPath=L;e.scrollEditorToPosition=M;e.updateProjectTabOnChange=function(){b.editorPanel.on("input",
function(){G(b.editorResource.resourcePath)})};e.formatEditorSource=function(){var a=b.editorPanel.getValue();x.ajax({contentType:"text/plain",data:a,success:function(a){b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title})};e.setEditorTheme=function(a){null!=a&&(null!=b.editorPanel&&b.editorPanel.setTheme(a),b.editorTheme=a)};e.updateEditorFont=function(a,d){var c=N();b.editorPanel.completers=
[c];b.editorPanel.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:d})}})(n=l.FileEditor||(l.FileEditor={}))});
