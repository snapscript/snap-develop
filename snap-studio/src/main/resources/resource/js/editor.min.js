define("require exports jquery md5 ace w2ui common socket problem tree history project status keys commands".split(" "),function(U,k,q,F,A,G,g,Q,R,z,S,B,T,t,u){var H=function(){function b(b){this.editorBreakpoints={};this.editorMarkers={};this.editorTheme=this.editorLastModified=this.editorText=this.editorResource=null;this.editorCurrentTokens={};this.editorFocusToken=null;this.editorHistory={};this.editorPanel=null;this.editorLastModified=(new Date).getTime();this.editorPanel=b}b.prototype.init=
function(){t.KeyBinder.bindKeys();B.Project.changeProjectFont();v.scrollEditorToPosition();v.updateProjectTabOnChange()};return b}();k.FileEditorView=H;var J=function(){function b(b,g,m,k,w){this._lastModified=b;this._undoState=g;this._position=m;this._buffer=k;this._hash=w}b.prototype.getPosition=function(){return this._position};b.prototype.getUndoState=function(){return this._undoState};b.prototype.getLastModified=function(){return this._lastModified};b.prototype.getBuffer=function(){return this._buffer};
b.prototype.getHash=function(){return this._hash};return b}();k.FileEditorHistory=J;var K=function(){function b(b,g,m){this._undoStack=b;this._redoStack=g;this._dirtyCounter=m}b.prototype.getUndoStack=function(){return this._undoStack};b.prototype.getRedoStack=function(){return this._redoStack};b.prototype.getDirtyCounter=function(){return this._dirtyCounter};return b}();k.FileEditorUndoState=K;var L=function(){function b(b,g,m,k,w,q){this._lastModified=b;this._breakpoints=g;this._resource=m;this._undoState=
k;this._position=w;this._source=q}b.prototype.isStateValid=function(){return this._resource&&null!=this._source&&""!=this._source};b.prototype.getResource=function(){return this._resource};b.prototype.getPosition=function(){return this._position};b.prototype.getUndoState=function(){return this._undoState};b.prototype.getLastModified=function(){return this._lastModified};b.prototype.getBreakpoints=function(){return this._breakpoints};b.prototype.getSource=function(){return this._source};return b}();
k.FileEditorState=L;var x=function(){function b(b,g,m){this._row=b;this._column=g;this._scroll=m}b.prototype.getRow=function(){return this._row};b.prototype.getColumn=function(){return this._column};b.prototype.getScroll=function(){return this._scroll};return b}();k.FileEditorPosition=x;var v;(function(b){function k(){var a=c.editorPanel.getSession(),b;for(b in c.editorMarkers)if(c.editorMarkers.hasOwnProperty(b)){var d=c.editorMarkers[b];null!=d&&a.removeMarker(d)}c.editorMarkers={}}function v(){var a=
[],b=1,d;for(d in c.editorBreakpoints)if(c.editorBreakpoints.hasOwnProperty(d)){var h=c.editorBreakpoints[d],e;for(e in h)if(h.hasOwnProperty(e)&&1==h[e]){var f=z.FileTree.createResourcePath(d),g="\x3cdiv class\x3d'breakpointEnabled'\x3e"+f.getProjectPath()+"\x3c/div\x3e";a.push({recid:b++,name:g,location:"Line "+e,resource:f.getProjectPath(),line:parseInt(e),script:f.getResourcePath()})}}G.w2ui.breakpoints.records=a;G.w2ui.breakpoints.refresh();u.Command.updateScriptBreakpoints()}function m(){var a;
a=c.editorPanel.getSession().getUndoManager();var b=q.extend(!0,{},a.$undoStack),d=q.extend(!0,{},a.$redoStack);a=new K(b,d,a.dirtyCounter);b=c.editorPanel.getSession().getScrollTop();b=(d=c.editorPanel.selection.getCursor())?new x(d.row,d.column,b):new x(null,null,b);d=c.editorPanel.getValue();return new L(c.editorLastModified,c.editorBreakpoints,c.editorResource,a,b,d)}function I(a){a=a.toLowerCase();if(g.Common.stringEndsWith(a,".snap"))return"ace/mode/snapscript";if(g.Common.stringEndsWith(a,
".xml"))return"ace/mode/xml";if(g.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(g.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";if(g.Common.stringEndsWith(a,".pl"))return"ace/mode/perl";if(g.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(g.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(g.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(g.Common.stringEndsWith(a,".java"))return"ace/mode/java";if(g.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";
if(g.Common.stringEndsWith(a,".py"))return"ace/mode/python";if(g.Common.stringEndsWith(a,".html")||g.Common.stringEndsWith(a,".htm"))return"ace/mode/html";if(g.Common.stringEndsWith(a,".txt"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(g.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".project"))return"ace/mode/xml";g.Common.stringEndsWith(a,".classpath");return"ace/mode/text"}function w(a){a=z.FileTree.createResourcePath(a);
return M(a.getResourcePath())?(a=m(),{buffer:a.getSource(),lastModified:a.getLastModified()}):(a=c.editorHistory[a.getResourcePath()])?{buffer:a.getBuffer(),lastModified:a.getLastModified()}:null}function C(){return null!=c.editorResource?c.editorPanel.getValue()!=c.editorText:!1}function N(a){return M(a)?C():w(a).buffer?!0:!1}function M(a){return null!=c.editorResource&&c.editorResource.getResourcePath()==a?!0:!1}function O(){var a=c.editorPanel.getSession();if(c.editorResource&&c.editorResource.getResourcePath()){var b=
c.editorHistory[c.editorResource.getResourcePath()];if(b&&b.getPosition()){var d=b.getPosition(),b=d.getScroll(),h=d.getRow(),d=d.getColumn();0<=h&&0<=d?c.editorPanel.selection.moveTo(h,d):c.editorPanel.gotoLine(1);a.setScrollTop(b)}else c.editorPanel.gotoLine(1),a.setScrollTop(0)}else c.editorPanel.gotoLine(1),a.setScrollTop(0);c.editorPanel.focus()}function D(a){B.Project.markEditorTab(a,N(a))}function P(){return{getCompletions:function(a,b,d,h,e){b=a.getValue();var f=a.session.getLine(d.row);a=
c.editorResource.getProjectPath();f=f.substring(0,d.column);d=JSON.stringify({resource:a,line:d.row+1,complete:f,source:b,prefix:h});q.ajax({contentType:"application/json",data:d,dataType:"json",success:function(a){var c=a.expression,b=Math.max(0,c.lastIndexOf(".")+1);a=a.tokens;var d=[],h;for(h in a)if(a.hasOwnProperty(h)){var f=a[h];g.Common.stringStartsWith(h,c)&&(h=h.substring(b));d.push({className:"autocomplete_"+f,token:h,value:h,score:300,meta:f})}e(null,d)},error:function(){console.log("Completion control failed")},
processData:!1,type:"POST",url:"/complete/"+document.title})}}}function t(){var a=A.ace.edit("editor"),b=P();a.completers=[b];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});
a.on("guttermousedown",function(b){var d=b.domEvent.target;if(-1!=d.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(b.clientX>25+d.getBoundingClientRect().left)){var e=b.getDocumentPosition().row;if(null!=c.editorResource){var f=c.editorPanel.getSession(),d=c.editorBreakpoints[c.editorResource.getFilePath()],g=f.getBreakpoints(),n=!1,k;for(k in g)if(k==e){n=!0;break}n?f.clearBreakpoint(e):f.setBreakpoint(e);k=parseInt(e);null==d?(d={},d[k+1]=!0,c.editorBreakpoints[c.editorResource.getFilePath()]=
d):d[k+1]=1==d[k+1]?!1:!0}v();b.stop()}});"undefined"!==typeof java&&a.setScrollSpeed(.05);return new H(a)}var c=null;b.createEditor=function(){c=t();c.init();Q.EventBus.createTermination(k)};b.clearEditorHighlights=k;b.showEditorLine=function(a){c.editorPanel.resize(!0);1<a?(c.editorPanel.scrollToLine(a-1,!0,!0,function(){}),c.editorPanel.gotoLine(a)):c.editorPanel.scrollToLine(0,!0,!0,function(){});c.editorPanel.focus()};b.createEditorHighlight=function(a,b){var d=A.ace.require("ace/range").Range,
h=c.editorPanel.getSession();k();d=h.addMarker(new d(a-1,0,a-1,1),b,"fullLine");c.editorMarkers[a]=d};b.createMultipleEditorHighlights=function(a,b){var d=A.ace.require("ace/range").Range,h=c.editorPanel.getSession();k();for(var e=0;e<a.length;e++){var f=a[e],g=h.addMarker(new d(f-1,0,f-1,1),b,"fullLine");c.editorMarkers[f]=g}};b.findAndReplaceTextInEditor=function(){var a=m().getResource();u.Command.searchAndReplaceFiles(a.getProjectPath())};b.findTextInEditor=function(){var a=m().getResource();
u.Command.searchFiles(a.getProjectPath())};b.addEditorKeyBinding=function(a,b){c.editorPanel.commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};b.showEditorBreakpoints=v;b.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+b);c.editorPanel.setAutoScrollEditorIntoView(!0);c.editorPanel.resize(!0)};b.resetEditor=function(){var a=c.editorPanel.getSession();
k();c.editorResource=null;c.editorPanel.setReadOnly(!1);a.setValue(c.editorText,1);q("#currentFile").html("")};b.currentEditorState=m;b.resolveEditorMode=I;b.clearSavedEditorBuffer=function(a){a=z.FileTree.createResourcePath(a);var b=c.editorHistory[a.getResourcePath()];b&&(b.lastModified=-1,b.buffer=null,D(a.getResourcePath()))};b.loadSavedEditorBuffer=w;b.updateEditor=function(a){var n=a.getResourcePath(),d=a.getFileContent(),h;console.log("resource\x3d["+a.getResourcePath().getResourcePath()+"] modified\x3d["+
a.getTimeStamp()+"] length\x3d["+a.getFileLength()+"]");b:{var e=a.getFileContent(),f=a.getResourcePath().getResourcePath();if(e){f=f.toLowerCase();if(g.Common.stringEndsWith(f,".json"))try{var l=JSON.parse(e);h=JSON.stringify(l,null,3);break b}catch(V){}h=e}else h=""}(e=w(a.getResourcePath().getResourcePath()))&&e.buffer&&e.lastModified>a.getLastModified()?(console.log("LOAD FROM HISTORY diff\x3d["+(e.lastModified-a.getLastModified())+"]"),h=e.buffer):console.log("IGNORE HISTORY: ",e);a=c.editorPanel.getSession();
e=a.getMode();l=I(n.getResourcePath());f=m();if(f.isStateValid()){var t=f.getSource(),t=F.md5(t),u=c.editorPanel.getValue(),u=C()?u:null;c.editorHistory[f.getResource().getResourcePath()]=new J(f.getLastModified(),f.getUndoState(),f.getPosition(),u,t)}l!=e&&a.setMode({path:l,v:Date.now()});c.editorPanel.setReadOnly(!1);c.editorPanel.setValue(h,1);e=h;l=n.getResourcePath();h=new A.ace.UndoManager;if(e&&l&&(l=z.FileTree.createResourcePath(l),f=c.editorHistory[l.getResourcePath()]))if(e=F.md5(e),f.hash==
e){var e=f.getUndoState(),l=e.getUndoStack(),f=e.getRedoStack(),p;for(p in l)l.hasOwnProperty(p)&&(h.$undoStack[p]=l[p]);for(var x in f)f.hasOwnProperty(x)&&(h.$redoStack[x]=l[x]);h.$doc=a;h.dirtyCounter=e.getDirtyCounter()}else c.editorHistory[l.getResourcePath()]=null;a.setUndoManager(h);p=c.editorPanel.getSession();for(var r in p.$backMarkers)p.removeMarker(r);k();r=p.getBreakpoints();for(var y in r)p.clearBreakpoint(y);q("#currentFile").html("");c.editorResource=n;c.editorText=d;window.location.hash=
c.editorResource.getProjectPath();R.ProblemManager.highlightProblems();if(null!=n&&c.editorResource&&(n=c.editorBreakpoints[c.editorResource.getFilePath()],null!=n))for(var E in n)n.hasOwnProperty(E)&&1==n[E]&&(r=parseInt(E)-1,null!=c.editorResource&&(d=c.editorPanel.getSession(),y=c.editorBreakpoints[c.editorResource.getFilePath()],r=parseInt(r),d.setBreakpoint(r),null==y&&(y={},c.editorBreakpoints[c.editorResource.getFilePath()]=y),y[r+1]=!0),v());B.Project.createEditorTab();S.History.showFileHistory();
T.StatusPanel.showActiveFile(c.editorResource.getProjectPath());b.showEditorFileInTree();O();D(c.editorResource.getResourcePath())};b.showEditorFileInTree=function(){var a=m().getResource();z.FileTree.showTreeNode("explorerTree",a)};b.getCurrentLineForEditor=function(){return c.editorPanel.getSelectionRange().start.row};b.getSelectedText=function(){return c.editorPanel.getSelectedText()};b.isEditorChanged=C;b.isEditorChangedForPath=N;b.scrollEditorToPosition=O;b.updateProjectTabOnChange=function(){c.editorPanel.on("input",
function(){c.editorLastModified=(new Date).getTime();D(c.editorResource.getResourcePath())})};b.formatEditorSource=function(){var a=c.editorPanel.getValue(),b=c.editorResource.getFilePath();q.ajax({contentType:"text/plain",data:a,success:function(a){c.editorPanel.setReadOnly(!1);c.editorPanel.setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title+b})};b.setEditorTheme=function(a){null!=a&&(null!=c.editorPanel&&c.editorPanel.setTheme(a),
c.editorTheme=a)};b.updateEditorFont=function(a,b){var d=P();c.editorPanel.completers=[d];c.editorPanel.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:b})}})(v=k.FileEditor||(k.FileEditor={}))});
